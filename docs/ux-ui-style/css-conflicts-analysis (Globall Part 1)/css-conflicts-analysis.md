# CSS競合分析レポート - global.css

**作成日**: 2024年12月19日  
**分析者**: Winston (Architect)  
**対象ファイル**: `src/styles/global.css`  
**分析時間**: 3時間（予定）

## エグゼクティブサマリー

`global.css`ファイルには複数の重大な競合が存在し、保守性とパフォーマンスに影響を与えています。主な問題は以下の通りです：

1. **重複するCSS変数定義** (高優先度)
2. **レイヤー競合** (中優先度)
3. **メディアクエリの重複** (中優先度)
4. **アニメーション定義の重複** (低優先度)

## 1. 重複するCSS変数定義 (CRITICAL)

### 1.1 色変数の重複
```css
/* 重複例1: プライマリカラー */
--clr-accent: oklch(0.65 0.25 280);           /* 行10 */
--color-accent-purple: oklch(0.65 0.25 280);  /* 行28 */
--color-accent: oklch(65% 0.18 280);          /* 行530 */

/* 重複例2: テキストカラー */
--clr-text-primary: oklch(1 0 0);             /* 行7 */
--color-text-primary: oklch(1 0 0);           /* 行27 */
--color-foreground: oklch(98% 0.002 270);     /* 行502 */
```

### 1.2 フォント変数の重複
```css
/* 重複例: フォントファミリー */
--font-primary: 'Inter', sans-serif;          /* 行61 */
--font-primary: 'Inter', system-ui, ...;      /* 行72 (上書き) */
```

### 1.3 スペーシング変数の重複
```css
/* 重複例: ボーダーラディウス */
--border-radius-lg: 12px;                     /* 行87 */
--radius-lg: 0.75rem;                         /* 行565 (12px相当) */
```

## 2. レイヤー競合 (HIGH)

### 2.1 レイヤー定義の不整合
```css
@layer critical { ... }    /* 行113 */
@layer base { ... }        /* 行653 */
@layer components { ... }  /* 行893 */
@layer utilities { ... }   /* 行979 */
```

**問題**: `critical`レイヤーが非標準で、Tailwindの標準レイヤーと競合する可能性

### 2.2 レイヤー内での重複スタイル
- `.card`クラスが複数のレイヤーで定義されている可能性
- ボタンスタイルが複数箇所で定義

## 3. メディアクエリの重複 (MEDIUM)

### 3.1 レスポンシブブレークポイントの重複
```css
@media (max-width: 768px) { ... }  /* 行883 */
@media (max-width: 768px) { ... }  /* 行1597 */
```

### 3.2 プリントスタイルの重複
```css
@media print { ... }  /* 行1491 */
@media print { ... }  /* 行1632 */
```

## 4. アニメーション定義の重複 (LOW)

### 4.1 キーフレームの重複
- `twinkle`アニメーションが複数箇所で定義
- 類似のアニメーション効果が重複

## 5. 優先度マトリックス

| 競合カテゴリ | 影響度 | 修正難易度 | 優先度 | 推定時間 |
|-------------|--------|------------|--------|----------|
| 色変数重複 | 高 | 中 | **P0** | 60分 |
| フォント変数重複 | 高 | 低 | **P0** | 30分 |
| レイヤー競合 | 中 | 高 | **P1** | 90分 |
| メディアクエリ重複 | 中 | 低 | **P1** | 45分 |
| アニメーション重複 | 低 | 低 | **P2** | 30分 |

## 6. 段階的修正計画

### Phase 1: 高優先度・低リスク (90分)
1. **色変数の統合** (60分)
   - `--clr-*`と`--color-*`の重複を解決
   - 一貫した命名規則の確立

2. **フォント変数の整理** (30分)
   - 重複するフォント定義を統合
   - フォールバックの最適化

### Phase 2: 中優先度 (135分)
1. **レイヤー構造の最適化** (90分)
   - `critical`レイヤーの削除または標準化
   - レイヤー間の依存関係の整理

2. **メディアクエリの統合** (45分)
   - 重複するメディアクエリをマージ
   - レスポンシブロジックの最適化

### Phase 3: 低優先度・検証 (15分)
1. **アニメーションの整理** (15分)
   - 重複するキーフレームの統合
   - パフォーマンスの最適化

## 7. リスク評価

### 高リスク
- 既存コンポーネントのスタイル破綻
- ブランドカラーの一貫性の喪失

### 中リスク
- レスポンシブデザインの崩れ
- アニメーション効果の変更

### 低リスク
- パフォーマンスの向上
- 保守性の改善

## 8. 推奨される修正アプローチ

1. **段階的修正**: 一度にすべてを変更せず、段階的に進める
2. **テスト駆動**: 各修正後にビジュアルリグレッションテストを実施
3. **ドキュメント化**: 変更内容を詳細に記録
4. **ロールバック計画**: 問題発生時の復旧手順を準備

## 9. 期待される効果

- **ファイルサイズ削減**: 約15-20%の削減
- **保守性向上**: 変数定義の一元化
- **パフォーマンス向上**: 重複CSSの削除
- **開発効率向上**: 一貫したデザインシステム

## 10. 次のステップ

1. この分析レポートの承認
2. Phase 1の修正開始
3. 各フェーズ完了後の検証
4. 最終的な統合テスト

---

**注意**: この修正作業は既存のスタイルを壊さないよう、慎重に段階的に進めます。各段階で十分なテストを行い、問題が発生した場合は即座にロールバックします。
