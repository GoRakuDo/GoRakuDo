@import 'tailwindcss';

/* ========== CONTENT PAGE LAYOUT ========== */

.content-page {
  @apply min-h-screen w-full relative z-[var(--z-content-main)] m-0;
  @apply bg-[length:30px_30px];
  @apply pt-20 pb-8 backdrop-blur-[1px];
  @apply md:pt-16 md:pb-6;
  @apply max-sm:pt-12 max-sm:pb-4;

  /* 75%透明度の背景色を適用 */
  background-color: oklch(from var(--token-black-base) l c h / 0.75);

  /* Content Container */
  .content-container {
    @apply max-w-4xl pt-8 px-0 pb-0 box-border;
    @apply md:pt-6;
    @apply max-sm:pt-4;
    @apply w-dvw max-w-full;

    /* Android Performance Optimization */
    @media screen and (max-width: 768px) {
      * {
        animation-duration: 0.2s; /* Faster animations for mobile */
      }
    }
  }

  /* Android Performance Optimization */
  @media screen and (max-width: 768px) {
    * {
      animation-duration: 0.2s; /* Faster animations for mobile */
    }
  }
}

/* ========== BREADCRUMB CONTAINER STYLING (Must come before nested selectors) ========== */

/* Breadcrumb Container Scrollbar Styling */
.content-container .breadcrumb-container {
  /* スクロールバーのスタイリング */
  @media (max-width: 767px) {
    &::-webkit-scrollbar {
      height: 3px;
    }

    &::-webkit-scrollbar-track {
      background: transparent;
    }

    &::-webkit-scrollbar-thumb {
      border-radius: 2px;
      background: oklch(100% 0 0deg / 0.3);
      transition: background 0.3s ease;
    }
  }

  /* スクロール可能な場合アニメーション効果 */
  @media (max-width: 767px) {
    position: relative;

    /* スクロール可能な場合左右フェード効果 */
    &::before,
    &::after {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      z-index: 1;
      width: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    &::before {
      left: 0;
      background: linear-gradient(
        to right,
        oklch(20% 0 0deg / 0.15) 0%,
        transparent 100%
      );
    }

    &::after {
      right: 0;
      background: linear-gradient(
        to left,
        oklch(20% 0 0deg / 0.15) 0%,
        transparent 100%
      );
    }
  }
}

/* ========== LAYOUT SUPPORT ========== */
.content-wrapper {
  @apply grid gap-0 px-0 max-w-full;

  /* スマホ: 1列レイアウト */
  grid-template-areas:
    'content'
    'toc';
  grid-template-columns: 1fr;

  /* タブレット以上: 2列レイアウト */
  @apply sm:gap-4;
  @apply md:gap-5;
  @apply lg:gap-6;
  @apply xl:gap-8;
  @apply 2xl:gap-8;

  /* スマホでのオーバーフロー防止 */
  @media (max-width: 767px) {
    overflow-x: hidden;
    width: 100%;
    max-width: 100%;
  }

  /* タブレット以上で2列Gridレイアウト */
  @media (min-width: 768px) {
    gap: 1.5rem;
    grid-template: 'content toc' 1fr / 1fr 300px;

    /* デスクトップでサイドバー幅調整 */
    @media (min-width: 1024px) {
      gap: 2rem;
      grid-template: 'content toc' 1fr / 1fr 320px;
    }

    @media (min-width: 1280px) {
      gap: 2.5rem;
      grid-template: 'content toc' 1fr / 1fr 350px;
    }
  }

  /* Content Container - Grid Area: content */
  .content-container {
    @apply min-w-0 max-w-full;

    /* Flexboxフレーム箱 */
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    grid-area: content;
    padding: 0.9375rem; /* 15px (12px × 1.25) */

    @apply sm:p-4;
    @apply md:p-6;
    @apply lg:p-7;
    @apply xl:p-8;
    @apply 2xl:p-10 2xl:max-w-4xl;

    /* レスポンシブギャップ */
    @media (min-width: 768px) {
      gap: 1rem;
    }

    @media (min-width: 1024px) {
      gap: 1.25rem;
    }

    /* Breadcrumb Container - Inside content-container */
    .breadcrumb-container {
      @apply w-full max-w-full overflow-hidden relative;

      /* Mobile Optimized: シンプルなスタイル - 影なし */
      border: 1px solid oklch(100% 0 0deg / 0.12);
      border-radius: 16px;
      background: oklch(18% 0 0deg / 0.95); /* モバイル: 不透明な背景 */
      box-shadow: none; /* モバイル: 影完全無効化 */
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

      /* Desktop: GlassMorphism効果 */
      @media (min-width: 769px) {
        background: linear-gradient(
          135deg,
          oklch(20% 0 0deg / 0.15) 0%,
          oklch(15% 0 0deg / 0.1) 100%
        );
        backdrop-filter: blur(12px) saturate(1.1);
        box-shadow:
          0 4px 20px oklch(0% 0 0deg / 0.08),
          0 1px 3px oklch(0% 0 0deg / 0.12),
          inset 0 1px 0 oklch(100% 0 0deg / 0.15);
      }

      /* スマホ画面でのマージンとパディング */
      @media (max-width: 767px) {
        overflow: auto hidden;
        width: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0.5rem 1rem;
        box-sizing: border-box;
        scrollbar-width: thin;
        scrollbar-color: oklch(100% 0 0deg / 0.3) transparent;
      }

      /* タブレット画面でのパディング */
      @media (min-width: 768px) and (max-width: 1023px) {
        padding: 0.5rem 0.75rem;
      }

      /* デスクトップ画面でのパディング */
      @media (min-width: 1024px) {
        padding: 0.625rem 1rem;
      }
    }

    /* Modern Breadcrumb Navigation */

    .modern-breadcrumb-nav {
      @apply w-full max-w-full m-0 p-0 overflow-hidden;
    }

    .breadcrumb-list {
      @apply w-full max-w-full overflow-x-auto overflow-y-hidden p-0 m-0;
    }

    .breadcrumb-item {
      @apply flex-shrink-0 max-w-fit gap-1 items-center;
    }

    .breadcrumb-icon {
      @apply flex-shrink-0 text-base leading-none;
    }

    .breadcrumb-separator {
      @apply flex-shrink-0 mx-1;
    }
  }

  /* Sidebar Container - Grid Area: toc */
  .sidebar-container {
    @apply w-full;

    grid-area: toc;
  }
}

/* ========== BREADCRUMB ========== */

.breadcrumb-nav {
  @apply bg-transparent backdrop-filter-none border-none shadow-none;

  /* スマホでのbreadcrumb-navのオーバーフロー防止 */
  @media (max-width: 767px) {
    display: flex;
    align-items: center;
    overflow: auto hidden;
    width: 100%;
    max-width: 100%;
    padding-left: 0.5rem;
    box-sizing: border-box;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */

    &::-webkit-scrollbar {
      display: none; /* Chrome/Safari */
    }
  }
}

/* Breadcrumb Container Hover Effect - Desktop Only */
@media (min-width: 769px) {
  .content-container .breadcrumb-container:hover {
    background: linear-gradient(
      135deg,
      oklch(25% 0 0deg / 0.2) 0%,
      oklch(20% 0 0deg / 0.15) 100%
    );
    border-color: color-mix(
      in oklch,
      var(--token-purple-base) 30%,
      transparent
    );
    box-shadow:
      0 8px 32px oklch(0% 0 0deg / 0.12),
      0 2px 8px oklch(0% 0 0deg / 0.08),
      inset 0 1px 0 oklch(100% 0 0deg / 0.2);
  }
}

/* Breadcrumb Scrollable States */
.breadcrumb-container.scrollable-left::before,
.breadcrumb-container.scrollable-right::after {
  opacity: 1;
}

.breadcrumb-container.scrolling {
  /* Desktop Only */
  @media (min-width: 769px) {
    box-shadow:
      0 4px 20px oklch(0% 0 0deg / 0.08),
      0 1px 3px oklch(0% 0 0deg / 0.12),
      inset 0 1px 0 oklch(100% 0 0deg / 0.15),
      0 0 0 1px color-mix(in oklch, var(--token-purple-base) 20%, transparent);
  }
}

/* ========== BUTTONS ========== */

/* Using high-frequency variables from global.css: --clr-accent, --clr-accent-glow-medium */
.back-to-content,
.back-to-docs,
.back-to-tools,
.share-btn {
  @apply inline-flex items-center gap-2 no-underline mb-0 outline-none h-10 box-border whitespace-nowrap;
  @apply text-sm font-medium text-[var(--clr-purple)];
  @apply bg-[var(--clr-accent-glow-faint)] px-4 py-2 rounded-lg;
  @apply border border-[var(--clr-accent-glow-medium)];
  @apply transition-all duration-300 ease-in-out;
  @apply hover:text-[var(--clr-accent-dark)] hover:bg-[var(--clr-accent-glow-medium)];
  @apply hover:border-[var(--clr-accent-glow-strong)] hover:-translate-y-px;
  @apply hover:shadow-[0_4px_12px_var(--clr-accent-glow-medium)];
  @apply focus-visible:outline-2 focus-visible:outline-[var(--clr-purple)] focus-visible:outline-offset-2;
  @apply focus-visible:shadow-[0_0_0_2px_var(--clr-accent-glow-medium)];
  @apply active:scale-95 active:transition-transform;
  @apply max-[480px]:px-3 max-[480px]:py-1.5 max-[480px]:text-[0.8rem] max-[480px]:h-9;
  @apply min-h-[44px] min-w-[44px]; /* Touch target accessibility */

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    border: 2px solid var(--clr-purple);
  }

  /* Android Performance Optimization */
  @media screen and (max-width: 768px) {
    animation-duration: 0.2s; /* Faster animations for mobile */

    &:hover {
      transform: none; /* Remove transform on Android hover (touch devices) */
    }
  }
}

/* ========== CONTENT HEADER ========== */

/* Using high-frequency variables from global.css: --clr-content-border, --clr-content-background-card, --shadow-content-card */
.content-header {
  @apply text-center mx-2 p-6 min-h-60;
  @apply flex flex-col justify-center items-center;
  @apply md:mx-1 md:p-5 md:min-h-50;
  @apply max-sm:mx-0 max-sm:p-4 max-sm:min-h-40;

  /* Mobile Optimized: シンプルなスタイル - 影なし */
  border: 1px solid oklch(100% 0 0deg / 0.12);
  border-radius: 16px;
  background: oklch(18% 0 0deg / 0.95); /* モバイル: 不透明な背景 */
  box-shadow: none; /* モバイル: 影完全無効化 */
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

  /* Desktop: GlassMorphism効果 */
  @media (min-width: 769px) {
    background: linear-gradient(
      135deg,
      oklch(20% 0 0deg / 0.15) 0%,
      oklch(15% 0 0deg / 0.1) 100%
    );
    backdrop-filter: blur(12px) saturate(1.1);
    box-shadow:
      0 4px 20px oklch(0% 0 0deg / 0.08),
      0 1px 3px oklch(0% 0 0deg / 0.12),
      inset 0 1px 0 oklch(100% 0 0deg / 0.15);
  }

  /* H1要素 - グラデーション維持 */
  h1 {
    @apply font-bold mb-8;

    padding-bottom: 0.1em; /* 下部に少し余白を追加 */

    /* 紫色→赤色グラデーション - 全デバイスで維持 */
    background: linear-gradient(
      135deg,
      oklch(65% 0.25 280deg) 30%,
      oklch(65% 0.18 15deg) 100%
    );
    background-clip: text;
    color: transparent;
    font-size: 2.25rem; /* 36px - チャレンジページ */
    line-height: 1.3; /* ディセンダーが切れないように十分な行間を確保 */

    @apply max-sm:text-xl max-sm:mb-3;
    @apply focus:outline-none focus:ring-2 focus:ring-[var(--clr-purple)] focus:ring-offset-2;
    @apply focus:ring-offset-[var(--clr-content-background-card)];

    /* タブレットサイズでのフォントサイズ調整 */
    @media (min-width: 768px) and (max-width: 1023px) {
      font-size: 1.5rem; /* 24px - タブレット */
    }
  }

  /* Content Meta */
  .content-meta {
    @apply flex items-center justify-center gap-5 mb-3 text-sm flex-wrap;
    @apply text-[var(--clr-content-meta)];
    @apply max-sm:gap-3 max-sm:text-[0.8rem];

    /* High Contrast Mode */
    @media (prefers-contrast: high) {
      color: oklch(100% 0 0deg / var(--opacity-95));
    }
  }

  .content-date,
  .content-author,
  .content-read-time {
    @apply text-[var(--clr-content-meta)];

    /* High Contrast Mode */
    @media (prefers-contrast: high) {
      color: oklch(100% 0 0deg / var(--opacity-95));
    }
  }

  /* Content Tags */
  .content-tags {
    @apply flex items-center justify-center gap-3;
  }

  /* Difficulty Badges */
  .difficulty-badge {
    @apply py-1.5 px-3 rounded-full text-xs font-semibold inline-block mx-auto text-center;

    &.difficulty-beginner {
      @apply bg-[oklch(60%_0.15_145deg/0.2)] text-green-300 border border-[oklch(60%_0.15_145deg/0.3)];
    }

    &.difficulty-intermediate {
      @apply bg-[oklch(70%_0.15_85deg/0.2)] text-yellow-300 border border-[oklch(70%_0.15_85deg/0.3)];
    }

    &.difficulty-advanced {
      @apply bg-[oklch(60%_0.15_25deg/0.2)] text-red-300 border border-[oklch(60%_0.15_25deg/0.3)];
    }
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    border: 2px solid oklch(50% 0.01 270deg);
  }
}

/* Content Header Hover Effect - Desktop Only */
@media (min-width: 769px) {
  .content-header:hover {
    background: linear-gradient(
      135deg,
      oklch(25% 0 0deg / 0.2) 0%,
      oklch(20% 0 0deg / 0.15) 100%
    );
    border-color: color-mix(
      in oklch,
      var(--token-purple-base) 30%,
      transparent
    );
    box-shadow:
      0 8px 32px oklch(0% 0 0deg / 0.12),
      0 2px 8px oklch(0% 0 0deg / 0.08),
      inset 0 1px 0 oklch(100% 0 0deg / 0.2);
  }
}

/* ========== CONTENT MAIN ========== */
.content-main {
  @apply p-6 px-4 max-w-none bg-transparent rounded-lg w-full relative block;
  @apply md:p-5 md:px-4;
  @apply max-sm:p-4;

  /* Prose paragraph styling */
  &.prose p {
    @apply mb-8 leading-relaxed; /* 32px bottom margin + relaxed line height */
  }

  /* Prose heading scroll margin */
  &.prose :where(h1, h2, h3, h4, h5) {
    @apply scroll-mt-8;
  }

  /* Prose H1 styling */
  &.prose h1 {
    @apply mb-6 leading-tight; /* 24px bottom margin */
  }

  /* H1要素 - 紫色→赤色グラデーション */
  h1 {
    @apply font-bold mb-8 leading-tight;

    /* 紫色→赤色グラデーション */
    background: linear-gradient(
      135deg,
      oklch(65% 0.25 280deg) 30%,
      oklch(65% 0.18 15deg) 100%
    );
    background-clip: text;
    color: transparent;
    font-size: 2.25rem; /* 36px - チャレンジページ */

    @apply max-sm:text-xl max-sm:mb-3;
    @apply focus:outline-none focus:ring-2 focus:ring-[var(--clr-purple)] focus:ring-offset-2;
    @apply focus:ring-offset-[var(--clr-content-background-card)];

    /* タブレットサイズでのフォントサイズ調整 */
    @media (min-width: 768px) and (max-width: 1023px) {
      font-size: 1.5rem; /* 24px - タブレット */
    }
  }

  /* 個別のスペーシング設定 */
  h2 {
    @apply relative mb-5 leading-tight; /* 20px bottom margin */

    /* H2の左側に装飾線を追加 */
    &::before {
      position: absolute;
      top: 0;
      left: -1.25rem;
      width: 4px;
      height: 100%;
      border-radius: 2px;
      background: linear-gradient(
        135deg,
        var(--clr-purple),
        var(--clr-accent-dark)
      );
      opacity: var(--opacity-80);
      content: '';
      transition: opacity 0.2s ease;
    }
  }

  /* H2-H6共通 - 紫色→赤色グラデーション */
  h2,
  h3,
  h4,
  h5,
  h6 {
    background: linear-gradient(
      135deg,
      oklch(65% 0.25 280deg) 5%,
      var(--token-white-base) 100%
    );

    /* stylelint-disable-next-line property-no-vendor-prefix */
    -webkit-background-clip: text;
    background-clip: text;

    /* stylelint-disable-next-line property-no-vendor-prefix */
    -webkit-text-fill-color: transparent;
  }

  /* 全見出し（H2-H6）のEmoji専用wrapper - グラデーションの影響を除外 */
  h2 .emoji,
  h3 .emoji,
  h4 .emoji,
  h5 .emoji,
  h6 .emoji {
    background: none;

    /* stylelint-disable-next-line property-no-vendor-prefix */
    -webkit-background-clip: initial;
    background-clip: initial;

    /* stylelint-disable-next-line property-no-vendor-prefix */
    -webkit-text-fill-color: initial;
    color: initial;
  }

  /* Prose underline styling - アンダーラインスタイル */
  .content-main u,
  .article-content u,
  .prose u {
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 0.2em;
    text-decoration-color: oklch(from var(--token-text-muted) l c h / 0.85);
  }

  /* Prose list styling */

  &.prose ul {
    @apply my-4;

    padding-left: 1.5rem;
    list-style-type: disc;
  }

  &.prose ol {
    @apply my-4;

    padding-left: 1.5rem;
    list-style-type: decimal;
  }

  /* Prose horizontal rule */

  &.prose hr {
    @apply my-4;
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    :where(h1, h2, h3, h4, h5) {
      color: oklch(100% 0 0deg);
    }

    :where(p, li, blockquote) {
      color: oklch(100% 0 0deg);
    }
  }

  /* Android Performance Optimization */
  @media screen and (max-width: 768px) {
    contain: layout style; /* Remove paint containment for better Android compatibility */
    will-change: auto;
  }
}

/* Content Main Prose List Items */

.content-main.prose ul li {
  @apply relative pl-2 mb-2;

  list-style-type: disc;
}

.content-main.prose ul li::before {
  display: none; /* Disable custom bullet to show default disc */
}

.content-main.prose ol li {
  @apply relative pl-2 mb-2;

  list-style-type: decimal;
}

/* Content Main Prose Last Child */

.prose p:last-child {
  @apply mb-0; /* Remove bottom margin from last paragraph */
}

/* ========== LEGACY SUPPORT ========== */

/* Consolidated legacy selectors for backward compatibility */
.post-header {
  @apply text-center mx-2 my-8 p-6 rounded-2xl min-h-60;
  @apply border border-[var(--clr-content-border)];
  @apply bg-[var(--clr-content-background-card)] backdrop-blur-[5px];
  @apply shadow-[var(--shadow-content-card)];
  @apply flex flex-col justify-center items-center;
  @apply md:mx-1 md:my-6 md:p-5 md:min-h-50;
  @apply max-sm:mx-0 max-sm:my-4 max-sm:p-4 max-sm:min-h-40;

  .post-meta {
    @apply flex items-center justify-center gap-5 mb-3 text-sm flex-wrap;
    @apply text-[var(--clr-content-meta)];
    @apply max-sm:gap-3 max-sm:text-[0.8rem];

    /* High Contrast Mode */
    @media (prefers-contrast: high) {
      color: oklch(100% 0 0deg / var(--opacity-95));
    }
  }

  .post-date,
  .post-author,
  .post-read-time {
    @apply text-[var(--clr-content-meta)];

    /* High Contrast Mode */
    @media (prefers-contrast: high) {
      color: oklch(100% 0 0deg / var(--opacity-95));
    }
  }

  .post-title {
    @apply text-inherit;
  }

  .post-tags {
    @apply flex items-center justify-center gap-3;
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    border: 2px solid oklch(50% 0.01 270deg);
  }
}

.post-content {
  @apply p-6 px-4 max-w-none bg-transparent rounded-lg w-full relative block;
  @apply text-[var(--clr-content-text)];
  @apply md:p-5 md:px-3;
  @apply max-sm:p-4 max-sm:px-2;

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    :where(h1, h2, h3, h4, h5) {
      color: oklch(100% 0 0deg);
    }

    :where(p, li, blockquote) {
      color: oklch(100% 0 0deg);
    }
  }
}

/* ========== ACTION BUTTONS ========== */

/* Using high-frequency variables from global.css: --clr-content-border, --clr-content-background-card-hover, --shadow-content-card */
.content-actions {
  @apply flex flex-col justify-between items-center gap-4 p-6 my-8 rounded-2xl;
  @apply border border-[var(--clr-content-border)];
  @apply bg-[var(--clr-content-background-card-hover)] backdrop-blur-[2px];
  @apply shadow-[var(--shadow-content-card)];
  @apply sm:flex-row;
  @apply md:my-6 md:p-5;
  @apply max-sm:my-4 max-sm:p-4 max-sm:gap-3;

  .action-buttons {
    @apply flex items-center gap-4 w-full justify-between;
    @apply max-sm:flex-col max-sm:gap-3;
    @apply max-[480px]:gap-2;
  }

  .share-buttons {
    @apply flex gap-3 items-center;
    @apply max-[480px]:gap-2;
  }

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    border: 2px solid oklch(50% 0.01 270deg);
  }

  /* Mobile Performance Optimization - 影完全無効化 */
  @media screen and (max-width: 768px) {
    background: oklch(18% 0 0deg / 0.95);
    box-shadow: none;
  }

  /* Desktop: Enhanced styling */
  @media (min-width: 769px) {
    backdrop-filter: blur(2px);
  }
}

.post-actions {
  @apply flex flex-col justify-between items-center gap-4 p-6 my-8 rounded-2xl;
  @apply border border-[var(--clr-content-border)];
  @apply bg-[var(--clr-content-background-card-hover)] backdrop-blur-[2px];
  @apply shadow-[var(--shadow-content-card)];
  @apply sm:flex-row;
  @apply md:my-6 md:p-5;
  @apply max-sm:my-4 max-sm:p-4 max-sm:gap-3;

  /* High Contrast Mode */
  @media (prefers-contrast: high) {
    border: 2px solid oklch(50% 0.01 270deg);
  }

  /* Mobile Performance Optimization - 影完全無効化 */
  @media screen and (max-width: 768px) {
    background: oklch(18% 0 0deg / 0.95);
    box-shadow: none;
  }

  /* Desktop: Enhanced styling */
  @media (min-width: 769px) {
    backdrop-filter: blur(2px);
  }
}

/* ========== READING PROGRESS ========== */
.reading-progress {
  @apply fixed top-0 left-0 w-0 h-[3px] z-[var(--z-content-progress)];
  @apply transition-[width] duration-100 ease-linear;

  background: linear-gradient(90deg, var(--clr-purple), var(--clr-accent-dark));
}

/* ========== CODE BLOCKS ========== */
code {
  padding: 0;
  background: none;
}

pre {
  @apply my-4 p-4 border border-[var(--clr-accent-glow-faint)] rounded-lg;
  @apply bg-none shadow-[var(--shadow-content-card)];
  @apply overflow-x-auto;
}

/* ========== ASTRO-CLOUDINARY CLDIMAGE ========== */

/* CldImage component styling - always rounded corners and centered */
.content-main img[src*='cloudinary'],
.prose img[src*='cloudinary'],
.article-content img[src*='cloudinary'],
img[data-cloudinary] {
  @apply rounded-lg mx-auto block;

  display: block;
  margin-right: auto;
  margin-left: auto;
  border-radius: 0.5rem;
}

/* Additional styling for CldImage components */
.content-main img,
.prose img,
.article-content img {
  @apply rounded-lg mx-auto block;

  display: block;
  margin-right: auto;
  margin-left: auto;
  border-radius: 0.5rem;
}
