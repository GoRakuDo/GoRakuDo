---
import 'tailwindcss';
// src/components/homepage/hero.astro
const {
  kicker = 'Belajar bahasa Jepang?',
  marker = '#Go-IMMERSE',
  titleLine1 = 'Belajar Secara Alami,',
  titleLine2 = 'Kuasai Layaknya Penutur Asli.',
  description = 'Dimana bahasa Jepang tidak lagi diterjemahkan di kepala, tetapi dipahami seperti bahasa ibu🔥',
  ctaPrimary = 'Mulai Perjalananmu',
  ctaSecondary = 'Gabung Komunitas',
  missionId = 'mission',
  invitationModalId = 'invitationModal',
  navbarSelector = '.navbar',
} = Astro.props;
---

<section
  class='relative flex flex-col items-center justify-center text-center min-h-screen
         bg-gradient-to-b from-indigo-950 via-indigo-900 to-indigo-800'
  style='background: transparent;'
  aria-labelledby='hero-title'
  data-mission-id={missionId}
  data-invitation-modal-id={invitationModalId}
  data-navbar-selector={navbarSelector}
  transition:name='hero-section'
>
  <div
    id='hero-content'
    class='flex flex-col items-center justify-center min-h-screen w-full max-w-5xl z-20
           opacity-0 translate-y-16 scale-80 blur-md transition-all duration-700 ease-out'
    style='background: transparent;'
    transition:name='hero-content'
  >
    <div
      class='hero-kicker text-[var(--clr-accent)] font-medium italic tracking-wide leading-tight opacity-70'
      transition:name='hero-kicker'
    >
      {kicker}
    </div>

    <h1
      id='hero-title'
      class='hero-title w-full font-bold leading-tight max-w-4xl mx-auto'
      transition:name='hero-title'
    >
      <span
        class='hero-marker gold-marker block mb-2'
        style='margin-bottom: 0.5rem;'
        transition:name='hero-marker'>{marker}</span
      >
      <span
        class='white-gradient-text block sm:inline font-extrabold mt-3!'
        transition:name='hero-title-line-1'>{titleLine1}</span
      >
      <span
        class='white-gradient-text block sm:inline font-medium'
        transition:name='hero-title-line-2'>{titleLine2}</span
      >
    </h1>

    <p
      class='hero-description max-w-xl italic mx-auto mt-4 leading-relaxed text-[var(--clr-text-muted)]'
      style='margin-bottom: 1.5rem;'
      transition:name='hero-description'
    >
      {description}
    </p>

    <div
      class='hero-buttons'
      role='group'
      aria-label='メインアクションボタン'
      transition:name='hero-buttons'
    >
      <button
        type='button'
        class='primary-button'
        data-action='scroll-to-mission'
        aria-label='学習の旅を始める - メインアクション'
        aria-describedby='primary-button-description'
        transition:name='hero-primary-button'
      >
        <span class='button-text'>{ctaPrimary}</span>
        <svg
          width='16'
          height='16'
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'
          aria-hidden='true'
          focusable='false'
          style='width: 16px; height: 16px;'
        >
          <path d='M5 12h14M12 5l7 7-7 7'></path>
        </svg>
      </button>
      <div id='primary-button-description' class='sr-only'>
        日本語学習の旅を始めるためのメインボタンです。クリックすると学習セクションに移動します。
      </div>

      <button
        type='button'
        class='secondary-button'
        data-action='open-invitation'
        aria-label='Discordコミュニティに参加する'
        aria-describedby='secondary-button-description'
        transition:name='hero-secondary-button'
      >
        <span class='button-text'>{ctaSecondary}</span>
        <svg
          class='btn-icon'
          role='img'
          viewBox='0 0 24 24'
          xmlns='http://www.w3.org/2000/svg'
          aria-label='Discordアイコン'
          focusable='false'
          style='width: 16px; height: 16px;'
        >
          <path
            d='M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z'
            fill='currentColor'></path>
        </svg>
      </button>
      <div id='secondary-button-description' class='sr-only'>
        Discordコミュニティに参加して、他の学習者と交流できます。
      </div>
    </div>
  </div>
</section>

<!-- Pure client script — NO server-side interpolation here -->
<script is:inline>
  (() => {
    // Read server-provided values via data-* attributes (no ${...} inside script)
    const heroSection = document.querySelector('section[data-mission-id]');
    const MISSION_ID = heroSection?.dataset?.missionId || 'mission';
    const INVITATION_MODAL_ID =
      heroSection?.dataset?.invitationModalId || 'invitationModal';
    const NAVBAR_SELECTOR = heroSection?.dataset?.navbarSelector || '.navbar';

    // Reveal animation
    function setupHeroAnimation() {
      const heroContent = document.querySelector('#hero-content');
      if (!heroContent) return;
      setTimeout(() => {
        heroContent.classList.remove(
          'opacity-0',
          'translate-y-16',
          'scale-80',
          'blur-md'
        );
      }, 300);
    }

    // Open modal
    function openInvitationModal() {
      try {
        if (typeof window.openInvitationModal === 'function') {
          window.openInvitationModal();
        }
      } catch (err) {
        console.error('openInvitationModal error:', err);
      }
    }

    // Close modal
    function closeInvitationModal() {
      try {
        const modal = document.getElementById(INVITATION_MODAL_ID);
        if (!modal) return;
        modal.style.opacity = '0';
        setTimeout(() => {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }, 200);
      } catch (err) {
        console.error('closeInvitationModal error:', err);
      }
    }

    // Scroll to mission
    function scrollToMission() {
      try {
        const missionSection = document.getElementById(MISSION_ID);
        const navbar = document.querySelector(NAVBAR_SELECTOR);
        if (missionSection && navbar) {
          const navbarHeight = navbar.offsetHeight || 0;
          const missionTop =
            missionSection.getBoundingClientRect().top + window.pageYOffset;
          const desiredTopMargin = 40;
          const scrollToPos = missionTop - navbarHeight - desiredTopMargin;
          window.scrollTo({ top: scrollToPos, behavior: 'smooth' });
          return;
        }
        if (missionSection) {
          missionSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        console.warn('Mission section not found.');
      } catch (err) {
        console.error('scrollToMission error:', err);
      }
    }

    // Delegate clicks on data-action buttons
    document.addEventListener('click', ev => {
      const el = ev.target;
      if (!el || typeof el.closest !== 'function') return;
      const btn = el.closest('[data-action]');
      if (!btn) return;
      const action = btn.dataset.action;
      if (action === 'open-invitation') openInvitationModal();
      else if (action === 'scroll-to-mission') scrollToMission();
    });

    // Register listener
    window.addEventListener('open-invitation-modal', openInvitationModal);
    window.addEventListener('close-invitation-modal', closeInvitationModal);

    // Expose global API to support legacy inline onclicks:
    window.openInvitationModal = openInvitationModal;
    window.closeInvitationModal = closeInvitationModal;
    window.scrollToMission = scrollToMission;

    // Init animation when DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupHeroAnimation);
    } else {
      setupHeroAnimation();
    }
  })();
</script>

<style>
  @layer base {
    /* Critical hero styles */
    .hero-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 0 15px;
    }

    /* Screen reader only content */
    .sr-only {
      position: absolute;
      overflow: hidden;
      width: 1px;
      height: 1px;
      margin: -1px;
      padding: 0;
      border: 0;
      white-space: nowrap;
      clip-path: inset(50%);
    }

    /* Skip link for keyboard navigation */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      z-index: 1000;
      padding: 8px;
      border-radius: 4px;
      background: var(--clr-accent);
      color: var(--clr-text-primary);
      text-decoration: none;
    }

    .skip-link:focus {
      top: 6px;
    }
  }

  @layer components {
    /* ---------- Hero buttons container (optimized UX design) ---------- */
    section .hero-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      width: 100%;
      max-width: 100%;
      margin-top: 2rem; /* より目立つスペーシング */

      /* Mobile: 320px+ - タッチフレンドリー */
      @media (min-width: 320px) {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem; /* ボタン間のスペースを広げる */
        max-width: 28rem; /* より広い最大幅 */
        padding: 0 2rem; /* 左右のパディングで余白確保 (1rem * 1.5 = 0.5倍増加) */
      }

      /* Tablet: 768px+ - バランスの取れたレイアウト */
      @media (min-width: 768px) {
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 1.5rem;
        max-width: 40rem;
        padding: 0 2rem;
      }

      /* Desktop: 1280px+ - 広々としたレイアウト */
      @media (min-width: 1280px) {
        gap: 2rem;
        max-width: 50rem;
        padding: 0 3rem;
      }
    }

    /* ---------- WCAG 2.1 Compliant Button Styling ---------- */
    section .primary-button,
    section .secondary-button {
      position: relative;
      overflow: hidden;
      min-width: 44px;
      min-height: 44px;
      cursor: pointer;
      transform: translateZ(0); /* ハードウェアアクセラレーション */
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

      /* ボタンテキストのスタイリング */
      .button-text {
        display: inline-block;
        font-weight: inherit;
      }

      /* Mobile: 320px+ - タッチフレンドリーサイズ */
      @media (min-width: 320px) {
        justify-content: center;
        min-height: 3rem; /* 48px - WCAG AA準拠 */
        padding: 1rem 2rem; /* より大きなタッチエリア */
        border-radius: 0.75rem; /* より丸みを帯びたデザイン */
        font-size: 1rem;
        line-height: 1.5; /* 読みやすさ向上 */
      }

      /* Tablet: 768px+ - バランスの取れたサイズ */
      @media (min-width: 768px) {
        min-height: 3.25rem; /* 52px */
        padding: 1.125rem 2.5rem;
        border-radius: 0.875rem;
        font-size: 1.125rem;
        line-height: 1.4;
      }

      /* Desktop: 1280px+ - プレミアムサイズ */
      @media (min-width: 1280px) {
        min-height: 3.5rem; /* 56px */
        padding: 1.25rem 3rem;
        border-radius: 1rem;
        font-size: 1.25rem;
        line-height: 1.3;
      }
    }

    /* ---------- Primary button (WCAG 2.1 compliant gradient pill) ---------- */
    section .primary-button {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem; /* 0.5rem for consistent spacing */
      border: 0;
      border-radius: var(--border-radius-pill);

      /* Visuals: keep gradient via custom property for exact control */
      background-image: linear-gradient(
        135deg,
        var(--clr-accent) 0%,
        var(--clr-accent-dark) 100%
      );
      color: var(--clr-text-primary);

      /* Layout */
      font-weight: 500; /* font-medium equivalent */
      cursor: pointer;
      user-select: none;
      transform: translateZ(0);

      /* REASONING: Individual property transitions for fine control */
      transition:
        background-image var(--transition-bg),
        box-shadow var(--transition-shadow),
        transform var(--transition-transform),
        opacity var(--transition-opacity);
      touch-action: manipulation;
      box-shadow: 0 2px 8px oklch(0% 0 0deg / 0.1);

      /* REASONING: GPU acceleration for get started buttons */
      will-change: transform, background-color, box-shadow;

      /* REASONING: Touch-specific enhancements */
      -webkit-tap-highlight-color: transparent;
    }

    /* ensure svg icon size and prevent shrinking */
    section .primary-button svg {
      flex-shrink: 0; /* flex-shrink-0 equivalent */
      width: 1rem; /* 1rem for consistent icon size */
      height: 1rem; /* 1rem for consistent icon size */
    }

    /* ---------- Secondary button (WCAG 2.1 compliant outlined pill) ---------- */
    section .secondary-button {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.75rem; /* 0.75rem for consistent spacing */
      border: 0.1875rem solid var(--clr-gold-dark-transparent); /* 3px converted to rem */
      border-radius: var(--border-radius-pill);
      background: transparent;
      color: var(--clr-gold-dark);
      font-weight: 500; /* font-medium equivalent */
      cursor: pointer;
      user-select: none;
      transform: translateZ(0);

      /* REASONING: Individual property transitions for fine control */
      transition:
        background-color var(--transition-bg),
        border-color var(--transition-border),
        box-shadow var(--transition-shadow),
        transform var(--transition-transform),
        opacity var(--transition-opacity);
      touch-action: manipulation;
      box-shadow: 0 2px 8px oklch(0% 0 0deg / 0.1);

      /* REASONING: GPU acceleration for get started buttons */
      will-change: transform, background-color, box-shadow;

      /* REASONING: Touch-specific enhancements */
      -webkit-tap-highlight-color: transparent;
    }

    /* ---------- WCAG 2.1 Enhanced Focus / Accessibility ---------- */
    section .primary-button:focus-visible,
    section .secondary-button:focus-visible {
      outline: none;

      /* WCAG 2.1 AA: フォーカスインジケーターは2px以上 */
      box-shadow:
        0 0 0 3px var(--clr-accent-glow-medium),
        0 0 0 5px oklch(100% 0 0deg / 0.3),
        0 12px 35px var(--clr-accent-shadow);
      transform: translateY(-1px);
    }

    /* WCAG 2.1: キーボードナビゲーション対応 */
    section .primary-button:focus,
    section .secondary-button:focus {
      outline: 2px solid var(--clr-accent);
      outline-offset: 2px;
    }

    .hero-buttons .primary-button:hover {
      background-image: linear-gradient(
        135deg,
        var(--clr-accent-dark) 0%,
        var(--clr-primary-dark) 100%
      );
      box-shadow: var(--shadow-hover);
      transform: var(--hover-lift-enhanced);

      /* Individual hover transitions for smooth animation */
      transition:
        background-image var(--transition-bg),
        box-shadow var(--transition-shadow),
        transform var(--transition-transform);
    }

    .hero-buttons .primary-button:active {
      opacity: 0.95;
      transform: translateZ(0) translateY(0);
      box-shadow: 0 1px 4px oklch(0% 0 0deg / 0.2);

      /* Smooth active state transition */
      transition:
        opacity var(--transition-opacity),
        transform var(--transition-transform),
        box-shadow var(--transition-shadow);
    }

    /* Icon styling for secondary button */
    section .secondary-button .btn-icon {
      flex-shrink: 0;
      width: 1rem; /* 1rem for consistent icon size */
      height: 1rem; /* 1rem for consistent icon size */
      color: inherit; /* Inherits the button's text color */
      transition: color var(--transition-fast) ease;
    }

    .hero-buttons .secondary-button:hover {
      background: var(--clr-accent-glow-medium);
      border-color: var(--clr-gold-dark);
      box-shadow: var(--shadow-hover);
      transform: var(--hover-lift-enhanced);

      /* Individual hover transitions for smooth animation */
      transition:
        background-color var(--transition-bg),
        border-color var(--transition-border),
        box-shadow var(--transition-shadow),
        transform var(--transition-transform);
    }

    .hero-buttons .secondary-button:active {
      opacity: 0.95;
      transform: translateZ(0) translateY(0);
      box-shadow: 0 1px 4px oklch(0% 0 0deg / 0.2);

      /* Smooth active state transition */
      transition:
        opacity var(--transition-opacity),
        transform var(--transition-transform),
        box-shadow var(--transition-shadow);
    }

    /* WCAG 2.1: タッチデバイスでのホバー無効化 */
    @media (hover: none) and (pointer: coarse) {
      section .primary-button:hover,
      section .secondary-button:hover {
        transform: none;
      }
    }

    /* WCAG 2.1: Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      section .primary-button,
      section .secondary-button {
        transform: none;
        transition: none;
        animation: none;
      }

      section .primary-button:hover,
      section .secondary-button:hover {
        transform: none;
        box-shadow: 0 4px 12px var(--clr-accent-shadow);
      }

      section .primary-button::before,
      section .secondary-button::after {
        display: none;
      }
    }

    /* WCAG 2.1: High contrast mode support */
    @media (prefers-contrast: high) {
      section .primary-button {
        border: 3px solid var(--clr-text-primary);
        background: var(--clr-text-primary);
        color: var(--clr-background);
      }

      section .secondary-button {
        border-width: 3px;
        background: var(--clr-text-primary);
        color: var(--clr-background);
        border-color: var(--clr-text-primary);
      }
    }

    /* WCAG 2.1: カラーコントラスト強化 */
    @media (prefers-contrast: more) {
      section .primary-button {
        border: 2px solid oklch(100% 0 0deg);
        background: oklch(0% 0 0deg);
        color: oklch(100% 0 0deg);
      }

      section .secondary-button {
        border: 2px solid oklch(0% 0 0deg);
        background: oklch(100% 0 0deg);
        color: oklch(0% 0 0deg);
      }
    }

    /* WCAG 2.1: フォーカストラップ対応 */
    section .hero-buttons:focus-within {
      outline: 2px solid var(--clr-accent);
      outline-offset: 4px;
      border-radius: 8px;
    }

    /* ---------- Responsive typography ---------- */
    section .hero-kicker {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        font-size: 0.875rem;
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        font-size: 1rem;
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        font-size: 1.125rem;
      }
    }

    section .hero-title {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        font-size: 1.5rem;
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        font-size: 1.875rem; /* 2.5rem * 0.75 = 0.25倍小さく */
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        font-size: 2.625rem; /* 3.5rem * 0.75 = 0.25倍小さく */
      }
    }

    section .hero-marker {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        font-size: 2rem;
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        font-size: 2.25rem; /* 3rem * 0.75 = 0.25倍小さく */
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        font-size: 3rem; /* 4rem * 0.75 = 0.25倍小さく */
      }
    }

    section .hero-description {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        font-size: 0.875rem;
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        font-size: 1.125rem;
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        font-size: 1.25rem;
      }
    }

    /* ---------- Responsive section paddings ---------- */
    .mission-section,
    .features-section,
    .docs-preview-section {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        padding-right: 1rem; /* 16px */
        padding-left: 1rem; /* 16px */
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        padding-right: 1.5rem; /* 24px */
        padding-left: 1.5rem; /* 24px */
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        padding-right: 2rem; /* 32px */
        padding-left: 2rem; /* 32px */
      }
    }

    /* ---------- Responsive hero section padding ---------- */
    .hero-section {
      /* Mobile: 320px+ */
      @media (min-width: 320px) {
        padding: 0 1rem; /* 16px */
      }

      /* Tablet: 768px+ */
      @media (min-width: 768px) {
        padding: 0 1.5rem; /* 24px */
      }

      /* Desktop: 1280px+ */
      @media (min-width: 1280px) {
        padding: 0 2rem; /* 32px */
      }
    }
  }

  @layer utilities {
    .gold-marker {
      display: block;
      margin-bottom: 0.5rem; /* 0.5rem for consistent spacing */
      background-image: linear-gradient(
        135deg,
        var(--clr-gold-light) 0%,
        var(--clr-gold-dark) 70%
      ); /* modern */

      color: var(--clr-gold-dark);
      text-shadow: 0.0625rem 0.0625rem 0.3125rem oklch(0% 0 0deg / 0.1); /* 1px 1px 5px converted to rem */
      background-clip: text; /* legacy Safari still honors bg-clip via webkit */
      -webkit-text-fill-color: transparent;
    }

    @supports (background-clip: text) {
      .gold-marker {
        color: transparent; /* text-transparent equivalent */
        background-clip: text; /* bg-clip-text equivalent */
      }
    }
  }

  @layer base {
    .hero-section {
      /* Base styles are now handled in components layer with responsive design */
    }
  }

  @layer animations {
    /* Hero section transitions */
    ::view-transition-old(hero-section),
    ::view-transition-new(hero-section),
    ::view-transition-old(hero-content),
    ::view-transition-new(hero-content) {
      animation-duration: 0.4s;
      animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }

    ::view-transition-old(hero-title),
    ::view-transition-new(hero-title) {
      animation-duration: 0.35s;
      animation-timing-function: ease-out;
    }

    ::view-transition-old(hero-buttons),
    ::view-transition-new(hero-buttons) {
      animation-duration: 0.3s;
      animation-delay: 0.1s;
    }

    /* Hero content animations */
    .hero-content {
      animation: fadeIn 0.6s ease-out;
    }

    /* Hero button animations */
    .hero-buttons {
      animation: slideFromBottom 0.6s ease-out 0.3s both;
    }
  }
</style>
