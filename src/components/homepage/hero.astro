---
import 'tailwindcss';
// src/components/homepage/hero.astro
const {
  kicker = 'Belajar bahasa Jepang?',
  marker = '#Go-IMMERSE',
  titleLine1 = 'Belajar Secara Alami,',
  titleLine2 = 'Kuasai Layaknya Penutur Asli.',
  description = 'Dimana bahasa Jepang tidak lagi diterjemahkan di kepala, tetapi dipahami secara instan seperti bahasa ibuðŸ”¥',
  ctaPrimary = 'Mulai Perjalananmu',
  ctaSecondary = 'Gabung Komunitas',
  missionId = 'mission',
  invitationModalId = 'invitationModal',
  navbarSelector = '.navbar',
} = Astro.props;
---

<section
  class='relative flex flex-col items-center justify-center text-center min-h-screen
         bg-gradient-to-b from-indigo-950 via-indigo-900 to-indigo-800
         px-4 sm:px-6 md:px-8'
  style='background: transparent;'
  aria-labelledby='hero-title'
  data-mission-id={missionId}
  data-invitation-modal-id={invitationModalId}
  data-navbar-selector={navbarSelector}
  transition:name='hero-section'
>
  <div
    id='hero-content'
    class='flex flex-col items-center justify-center min-h-screen w-full max-w-5xl z-20
           opacity-0 translate-y-16 scale-80 blur-md transition-all duration-700 ease-out'
    style=' padding: 1em;background: transparent;'
    transition:name='hero-content'
  >
    <div
      class='text-[var(--color-accent-purple)] font-medium italic tracking-wide leading-tight opacity-70
             text-base sm:text-lg md:text-xl'
      transition:name='hero-kicker'
    >
      {kicker}
    </div>

    <h1
      id='hero-title'
      class='w-full font-bold leading-tight max-w-4xl mx-auto mt-4 text-2xl md:text-5xl'
      style='margin-bottom: 1.5rem;'
      transition:name='hero-title'
    >
      <span
        class='gold-marker block text-4xl sm:text-5xl md:6xl mb-2'
        transition:name='hero-marker'>{marker}</span
      >
      <span
        class='white-gradient-text block sm:inline font-extrabold mt-3!'
        transition:name='hero-title-line-1'>{titleLine1}</span
      >
      <span
        class='white-gradient-text block sm:inline font-medium'
        transition:name='hero-title-line-2'>{titleLine2}</span
      >
    </h1>

    <p
      class='max-w-xl italic mx-auto mt-4
             text-xs sm:text-base md:text-lg lg:text-xl leading-relaxed text-[var(--color-text-muted)]'
      style='margin-bottom: 1.5rem;'
      transition:name='hero-description'
    >
      {description}
    </p>

    <div
      class='hero-buttons flex flex-col md:flex-row gap-4 mt-6 md:mt-8'
      transition:name='hero-buttons'
    >
      <button
        type='button'
        class='primary-button'
        data-action='scroll-to-mission'
        aria-label='Mulai perjalanan belajar immersion'
        transition:name='hero-primary-button'
      >
        {ctaPrimary}
        <svg
          width='16'
          height='16'
          viewBox='0 0 24 24'
          fill='none'
          stroke='currentColor'
          stroke-width='2'
          stroke-linecap='round'
          stroke-linejoin='round'
          aria-hidden='true'
        >
          <path d='M5 12h14M12 5l7 7-7 7'></path>
        </svg>
      </button>

      <button
        type='button'
        class='secondary-button'
        data-action='open-invitation'
        aria-label='Bergabung dengan komunitas Discord'
        transition:name='hero-secondary-button'
      >
        {ctaSecondary}
        <svg
          class='btn-icon'
          role='img'
          viewBox='0 0 24 24'
          xmlns='http://www.w3.org/2000/svg'
          aria-hidden='true'
        >
          <title>Discord</title>
          <path
            d='M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z'
            fill='currentColor'></path>
        </svg>
      </button>
    </div>
  </div>
</section>

<!-- Pure client script â€” NO server-side interpolation here -->
<script is:inline>
  (() => {
    // Read server-provided values via data-* attributes (no ${...} inside script)
    const heroSection = document.querySelector('section[data-mission-id]');
    const MISSION_ID = heroSection?.dataset?.missionId || 'mission';
    const INVITATION_MODAL_ID =
      heroSection?.dataset?.invitationModalId || 'invitationModal';
    const NAVBAR_SELECTOR = heroSection?.dataset?.navbarSelector || '.navbar';

    // Reveal animation
    function setupHeroAnimation() {
      const heroContent = document.querySelector('#hero-content');
      if (!heroContent) return;
      setTimeout(() => {
        heroContent.classList.remove(
          'opacity-0',
          'translate-y-16',
          'scale-80',
          'blur-md'
        );
      }, 300);
    }

    // Open modal
    function openInvitationModal() {
      try {
        if (typeof window.openInvitationModal === 'function') {
          window.openInvitationModal();
        }
      } catch (err) {
        console.error('openInvitationModal error:', err);
      }
    }

    // Close modal
    function closeInvitationModal() {
      try {
        const modal = document.getElementById(INVITATION_MODAL_ID);
        if (!modal) return;
        modal.style.opacity = '0';
        setTimeout(() => {
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }, 200);
      } catch (err) {
        console.error('closeInvitationModal error:', err);
      }
    }

    // Scroll to mission
    function scrollToMission() {
      try {
        const missionSection = document.getElementById(MISSION_ID);
        const navbar = document.querySelector(NAVBAR_SELECTOR);
        if (missionSection && navbar) {
          const navbarHeight = navbar.offsetHeight || 0;
          const missionTop =
            missionSection.getBoundingClientRect().top + window.pageYOffset;
          const desiredTopMargin = 40;
          const scrollToPos = missionTop - navbarHeight - desiredTopMargin;
          window.scrollTo({ top: scrollToPos, behavior: 'smooth' });
          return;
        }
        if (missionSection) {
          missionSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          return;
        }
        console.warn('Mission section not found.');
      } catch (err) {
        console.error('scrollToMission error:', err);
      }
    }

    // Delegate clicks on data-action buttons
    document.addEventListener('click', ev => {
      const el = ev.target;
      if (!el || typeof el.closest !== 'function') return;
      const btn = el.closest('[data-action]');
      if (!btn) return;
      const action = btn.dataset.action;
      if (action === 'open-invitation') openInvitationModal();
      else if (action === 'scroll-to-mission') scrollToMission();
    });

    // Register listener
    window.addEventListener('open-invitation-modal', openInvitationModal);
    window.addEventListener('close-invitation-modal', closeInvitationModal);

    // Expose global API to support legacy inline onclicks:
    window.openInvitationModal = openInvitationModal;
    window.closeInvitationModal = closeInvitationModal;
    window.scrollToMission = scrollToMission;

    // Init animation when DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupHeroAnimation);
    } else {
      setupHeroAnimation();
    }
  })();
</script>

<style>
  @layer base {
    /* Critical hero styles */
    .hero-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 0 15px;
    }
  }

  @layer components {
    /* ---------- Hero buttons container (base + mobile overrides) ---------- */
    .hero-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 1.25rem; /* gap-5 equivalent */

      /* Base */
      margin-top: 1.5rem; /* mt-6 equivalent */

      /* Tablet/Mobile â‰¤768px: make them stack & limit width */
      @media (max-width: 768px) {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        max-width: 350px;
        margin-right: auto;
        margin-left: auto;
      }
    }

    /* Center button contents on small screens */
    .primary-button,
    .secondary-button {
      @media (max-width: 768px) {
        justify-content: center;
      }
    }

    /* ---------- Primary button (gradient pill) ---------- */
    .primary-button {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem; /* gap-2 equivalent */
      padding: 16px 32px;
      border: 0;
      border-radius: var(--border-radius-pill);

      /* Visuals: keep gradient via custom property for exact control */
      background-image: linear-gradient(
        135deg,
        var(--color-accent-purple) 0%,
        var(--color-accent-dark) 100%
      );
      color: var(--color-text-primary);

      /* Layout */
      font-size: 16px;
      font-weight: 500; /* font-medium equivalent */
      cursor: pointer;
      user-select: none;
      transition:
        box-shadow var(--animate-duration-normal) ease,
        transform var(--animate-duration-fast) ease,
        opacity var(--animate-duration-fast) ease;
    }

    /* ensure svg icon size and prevent shrinking */
    .primary-button svg {
      flex-shrink: 0; /* flex-shrink-0 equivalent */
      width: 1rem; /* w-4 equivalent */
      height: 1rem; /* h-4 equivalent */
    }

    .primary-button:hover {
      box-shadow: 0 12px 35px var(--color-accent-shadow);
      transform: translateY(-1px);
    }

    .primary-button:active {
      opacity: 0.98;
      transform: translateY(0);
    }

    /* ---------- Secondary button (outlined pill) ---------- */
    .secondary-button {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 0.75rem; /* gap-2 equivalent */
      padding: 14px 32px;
      border: 2px solid var(--color-gold-dark-transparent); /* rounded-full equivalent */
      border-radius: var(--border-radius-pill);
      background: transparent;
      color: var(--color-gold-dark);
      font-size: 16px;
      font-weight: 500; /* font-medium equivalent */
      cursor: pointer;
      user-select: none;
      transition:
        background-color var(--animate-duration-fast) ease,
        border-color var(--animate-duration-fast) ease,
        color var(--animate-duration-fast) ease,
        transform var(--animate-duration-fast) ease;
      border-width: 3px;
    }

    /* Icon styling for secondary button */
    .secondary-button .btn-icon {
      flex-shrink: 0;
      width: 1rem; /* 16px */
      height: 1rem; /* 16px */
      color: inherit; /* Inherits the button's text color */
      transition: color var(--animate-duration-fast) ease;
    }

    .secondary-button:hover {
      background: var(--color-accent-glow-medium);
      border-color: var(--color-gold-dark);
    }

    /* ---------- Focus / accessibility ---------- */
    .primary-button:focus-visible,
    .secondary-button:focus-visible {
      outline: none; /* outline-none equivalent */

      /* keep the two-layer shadow you had */
      box-shadow:
        0 0 0 4px var(--color-accent-purple-glow-medium),
        0 12px 35px var(--color-accent-shadow);
    }

    /* ---------- Small-screen adjustments (optional) ---------- */
    @media (max-width: 480px) {
      .primary-button {
        padding: 12px 24px;
        font-size: 0.875rem; /* text-sm equivalent */
      }

      .secondary-button {
        padding: 10px 24px;
        font-size: 0.875rem; /* text-sm equivalent */
      }
    }

    /* ---------- Section paddings (your snippet) ---------- */
    .mission-section,
    .features-section,
    .docs-preview-section {
      @media (max-width: 768px) {
        padding-right: 20px;
        padding-left: 20px;
      }
    }

    /* Make mobile override explicit â€” use only if you want smaller mobile buttons */
    @media (max-width: 768px) {
      .hero-buttons .primary-button,
      .hero-buttons .btn-primary {
        min-width: auto;
        padding: 14px 28px;
        font-size: 15px;
      }
    }
  }

  @layer utilities {
    .gold-marker {
      display: block;
      margin-bottom: 0.5rem; /* mb-2 equivalent */
      background-image: linear-gradient(
        135deg,
        var(--color-gold-light) 0%,
        var(--color-gold-dark) 70%
      ); /* modern */

      color: var(--color-gold-dark);
      text-shadow: 1px 1px 5px rgb(0 0 0 / 0.1);
      background-clip: text; /* legacy Safari still honors bg-clip via webkit */
      -webkit-text-fill-color: transparent;
    }

    @supports (background-clip: text) {
      .gold-marker {
        color: transparent; /* text-transparent equivalent */
        background-clip: text; /* bg-clip-text equivalent */
      }
    }
  }

  @layer base {
    .hero-section {
      padding: 0 20px;
    }
  }
</style>
