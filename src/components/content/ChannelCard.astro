---
// ChannelCard Component - YouTubeチャンネルカード
// Astroネイティブ画像最適化対応・外部URL対応

import { Image } from 'astro:assets';
import Button from '../ui/Button.astro';

export interface Props {
  channelCover: string;
  channelName: string;
  channelProfile: string;
  channelURL: string;
}

const { channelCover, channelName, channelProfile, channelURL } = Astro.props;
---

<div class='channel-card'>
  <!-- 統合Flexboxコンテナ -->
  <div class='channel-content-container'>
    <!-- チャンネルカバー -->
    <div class='channel-cover-container'>
      <img
        src={channelCover}
        alt={`${channelName}のチャンネルカバー画像`}
        class='channel-cover'
        width='320'
        height='180'
        loading='lazy'
        decoding='async'
        crossorigin='anonymous'
        referrerpolicy='no-referrer'
        fetchpriority='low'
      />
      <!-- フォールバック画像 -->
      <div class='channel-cover-fallback' style='display: none;'>
        <div class='fallback-content'>
          <svg
            class='fallback-icon'
            viewBox='0 0 24 24'
            fill='none'
            stroke='currentColor'
            stroke-width='2'
          >
            <rect x='3' y='3' width='18' height='18' rx='2' ry='2'></rect>
            <circle cx='8.5' cy='8.5' r='1.5'></circle>
            <polyline points='21,15 16,10 5,21'></polyline>
          </svg>
          <span class='fallback-text'>画像を読み込めません</span>
        </div>
      </div>
    </div>

    <!-- チャンネル情報セクション -->
    <div class='channel-info-section'>
      <!-- プロファイル画像とヘッダー情報の横並びセクション -->
      <div class='channel-profile-header-section'>
        <!-- プロファイル画像（左寄せ） -->
        <div class='channel-profile-container'>
          <img
            src={channelProfile}
            alt={`${channelName}のプロファイル画像`}
            class='channel-profile'
            width='80'
            height='80'
            loading='lazy'
            decoding='async'
            crossorigin='anonymous'
            referrerpolicy='no-referrer'
            fetchpriority='low'
          />
          <!-- フォールバックプロファイル画像 -->
          <div class='channel-profile-fallback' style='display: none;'>
            <div class='fallback-profile'>
              <svg
                class='fallback-profile-icon'
                viewBox='0 0 24 24'
                fill='none'
                stroke='currentColor'
                stroke-width='2'
              >
                <path d='M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2'></path>
                <circle cx='12' cy='7' r='4'></circle>
              </svg>
            </div>
          </div>
        </div>

        <!-- チャンネルヘッダー情報（右隣、2行） -->
        <div class='channel-header'>
          <h3 class='channel-name'>{channelName}</h3>
        </div>
      </div>

      <!-- チャンネルアクション -->
      <div class='channel-actions'>
        <Button
          text='Lihat Channel'
          href={channelURL}
          target='_blank'
          variant='primary'
          size='sm'
          class='channel-button'
        />
      </div>
    </div>
  </div>

  <style is:global>
    .channel-card {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: var(--color-background-subtle);
      border: 1px solid var(--color-border-subtle);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      overflow: hidden;
      transition:
        box-shadow var(--transition-normal),
        border-color var(--transition-normal),
        transform var(--transition-normal);

      &:hover {
        box-shadow: var(--shadow-xl);
        border-color: var(--color-primary);
        transform: translateY(-2px);
      }

      &:focus-within {
        box-shadow: var(--shadow-xl);
        border-color: var(--color-primary);
        outline: 2px solid var(--color-primary);
        outline-offset: 2px;
      }
    }

    .channel-content-container {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .channel-cover-container {
      aspect-ratio: 21 / 9;
      overflow: hidden;
      flex-shrink: 0;
      border-radius: var(--radius-lg);
    }

    .channel-cover {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
      transition: filter var(--transition-normal);
    }

    .channel-cover-fallback {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      background: var(--color-background-muted);
      border: 2px dashed var(--color-border-subtle);
      border-radius: var(--radius-md);
    }

    .fallback-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--rc-space-sm);
      color: var(--color-text-muted);
    }

    .fallback-icon {
      width: 48px;
      height: 48px;
      opacity: 0.6;
    }

    .fallback-text {
      font-size: var(--font-size-sm);
      text-align: center;
    }

    .channel-card:hover .channel-cover {
      filter: brightness(1.1) contrast(1.05);
    }

    .channel-profile-header-section {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--rc-space-lg);
      margin-top: -35px;
      z-index: 2;
      flex-shrink: 0;
      padding: 0;
      width: 100%;
      box-sizing: border-box;

      @media (min-width: 768px) {
        margin-top: -45px;
        gap: var(--rc-space-xl);
        padding: 0;
      }

      @media (min-width: 1024px) {
        margin-top: -55px;
        gap: var(--rc-space-2xl);
        padding: 0;
      }
    }

    .channel-profile-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-shrink: 0;
    }

    .channel-profile,
    .channel-profile-fallback {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      box-shadow: var(--shadow-lg);

      @media (min-width: 768px) {
        width: 80px;
        height: 80px;
      }

      @media (min-width: 1024px) {
        width: 80px;
        height: 80px;
      }
    }

    .channel-profile {
      object-fit: cover;
      transition:
        filter var(--transition-normal),
        box-shadow var(--transition-normal),
        transform var(--transition-normal);
    }

    .channel-profile-fallback {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-background-muted);
    }

    .fallback-profile {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .fallback-profile-icon {
      width: 40px;
      height: 40px;
      color: var(--color-text-muted);
      opacity: 0.6;

      @media (min-width: 768px) {
        width: 40px;
        height: 40px;
      }

      @media (min-width: 1024px) {
        width: 40px;
        height: 40px;
      }
    }

    .channel-card:hover .channel-profile {
      filter: brightness(1.1) saturate(1.2);
      box-shadow: var(--shadow-xl);
      transform: scale(1.05);
    }

    .channel-info-section {
      display: flex;
      flex-direction: column;
      flex: 1;
      padding: 55px var(--rc-space-md) calc(var(--rc-space-md) * 1.25);
      gap: var(--rc-space-xl);

      @media (min-width: 768px) {
        padding: 65px var(--rc-space-lg) var(--rc-space-lg);
        gap: var(--rc-space-lg);
      }

      @media (min-width: 1024px) {
        padding: 75px var(--rc-space-xl) var(--rc-space-xl);
        gap: var(--rc-space-xl);
      }
    }

    .channel-header {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: var(--rc-space-xs);
      flex: 1;
      min-width: 0;
      max-width: 100%;

      @media (min-width: 768px) {
        gap: var(--rc-space-sm);
      }

      @media (min-width: 1024px) {
        gap: var(--rc-space-md);
      }
    }

    .channel-actions {
      display: flex;
      flex-direction: column;
      margin-top: auto;
    }

    .channel-name {
      font-size: clamp(1.3125rem, 3.75vw, 1.5rem);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text-primary);
      margin: 0;
      line-height: 1.3;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      text-align: center;
      max-width: 100%;

      @media (min-width: 768px) {
        font-size: clamp(1rem, 2vw, 1.125rem);
        line-height: 1.4;
        text-align: left;
      }

      @media (min-width: 1024px) {
        font-size: clamp(1.125rem, 1.5vw, 1.25rem);
        line-height: 1.4;
      }
    }

    .channel-button {
      width: 100%;
    }

    /* アクセシビリティ対応 */
    .channel-card {
      @media (prefers-reduced-motion: reduce) {
        transition: none;

        &:hover {
          transform: none;
        }

        &:hover .channel-cover {
          filter: none;
        }

        &:hover .channel-profile {
          filter: none;
          transform: none;
          box-shadow: var(--shadow-lg);
        }
      }

      @media (prefers-contrast: high) {
        border: 2px solid var(--color-text-primary);
      }
    }

    .channel-cover,
    .channel-profile {
      @media (prefers-reduced-motion: reduce) {
        transition: none;
      }
    }
  </style>
</div>
