---
export interface Props {
  tags: Array<{ tag: string; count: number }>;
}

const { tags } = Astro.props;

// タグのサイズを計算（使用回数に基づく）
const getTagSize = (count: number, maxCount: number) => {
  const ratio = count / maxCount;
  if (ratio > 0.8) return 'text-lg';
  if (ratio > 0.6) return 'text-base';
  if (ratio > 0.4) return 'text-sm';
  return 'text-xs';
};

// タグの色を計算（使用回数に基づく）
const getTagColor = (count: number, maxCount: number) => {
  const ratio = count / maxCount;
  if (ratio > 0.8) return 'bg-blue-100 text-blue-800 hover:bg-blue-200 dark:bg-blue-900 dark:text-blue-200 dark:hover:bg-blue-800';
  if (ratio > 0.6) return 'bg-green-100 text-green-800 hover:bg-green-200 dark:bg-green-900 dark:text-green-200 dark:hover:bg-green-800';
  if (ratio > 0.4) return 'bg-purple-100 text-purple-800 hover:bg-purple-200 dark:bg-purple-900 dark:text-purple-200 dark:hover:bg-purple-800';
  return 'bg-gray-100 text-gray-800 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600';
};

const maxCount = Math.max(...tags.map(t => t.count));
---

<div class="tag-cloud">
  {tags.map(({ tag, count }) => {
    const slug = tag.toLowerCase().replace(/ /g, '-');
    const sizeClass = getTagSize(count, maxCount);
    const colorClass = getTagColor(count, maxCount);
    
    return (
      <a
        href={`/tags/${slug}`}
        class={`tag-item ${sizeClass} ${colorClass} inline-block px-3 py-1 m-1 rounded-full transition-all duration-200 hover:scale-105`}
        title={`${count} post${count !== 1 ? 's' : ''} tagged with ${tag}`}
      >
        #{tag}
        <span class="text-xs opacity-75 ml-1">({count})</span>
      </a>
    );
  })}
</div>

<style>
  .tag-cloud {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    margin: 2rem 0;
    padding: 1rem;
  }
  
  .tag-item {
    text-decoration: none;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }
  
  .tag-item:hover {
    transform: translateY(-1px) scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-color: currentColor;
  }
  
  /* レスポンシブ調整 */
  @media (max-width: 640px) {
    .tag-cloud {
      gap: 0.25rem;
      padding: 0.5rem;
    }
    
    .tag-item {
      margin: 0.125rem;
      padding: 0.25rem 0.5rem;
    }
  }
</style>
