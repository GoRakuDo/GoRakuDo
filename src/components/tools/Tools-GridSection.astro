---
// ========== OPTIMIZED TOOLS GRID SECTION ==========
// Tools-GridSection.astro - 最適化されたツールグリッドセクションコンポーネント

// ========== TYPE DEFINITIONS ==========
interface Tool {
  readonly id: string;
  readonly name: string;
  readonly description: string;
  readonly iconUrl: string;
  readonly color?: string;
  readonly link: string;
}

// ========== COMPONENT PROPS TYPE DEFINITIONS ==========
export interface GridSectionProps {
  tools: Tool[];
  className?: string;
  title?: string;
  description?: string;
  showTitle?: boolean;
}

// ========== OPTIMIZED CONFIGURATION ==========
const DEFAULT_ANIMATION_CLASS = 'animation-scale';

// ========== OPTIMIZED UTILITY FUNCTIONS ==========
const getAnimationClass = (): string => {
  return DEFAULT_ANIMATION_CLASS;
};

const validateTool = (tool: Tool): boolean =>
  !!(tool.id && tool.name && tool.description && tool.iconUrl && tool.link);

// 説明文を最初のセンテンスのみに分割する関数
const getFirstSentence = (description: string): string => {
  // ピリオド、感嘆符、疑問符で分割し、最初のセンテンスを取得
  const sentences = description.split(/[.!?]+/);
  const firstSentence = sentences[0]?.trim();

  // センテンスが空でない場合は、適切な句読点を追加
  if (firstSentence && firstSentence.length > 0) {
    // 元のテキストがピリオドで終わっている場合はピリオドを追加
    if (description.includes('.')) {
      return firstSentence + '.';
    }
    return firstSentence;
  }

  // フォールバック: 元の説明文を返す
  return description;
};

// ========== OPTIMIZED DATA PROCESSING ==========
const { tools = [], className = '' } = Astro.props;

// ツールの検証とフィルタリング
const validTools: Tool[] = tools.filter(validateTool);
---

<section
  class={`py-8 sm:py-12 lg:py-16 scroll-reveal ${className}`}
  aria-labelledby='tools-title'
  id='tools-main-content'
>
  <div class='w-full flex justify-center px-2 sm:px-6 lg:px-8'>
    <div class='tools-grid' role='list' aria-label='Available learning tools'>
      {
        validTools.map(tool => (
          <div class='tool-grid-item' role='listitem'>
            <article class='tool-card-wrapper'>
              <a
                href={tool.link}
                class={`tool-card glassmorphism glassmorphism-card group ${getAnimationClass()}`}
                aria-labelledby={`tool-name-${tool.id}`}
                aria-describedby={`tool-desc-${tool.id}`}
                aria-label={`Learn more about ${tool.name} tool`}
              >
                <div class='tool-card-frame'>
                  <header class='tool-card-header'>
                    <div class='tool-title-container'>
                      <div
                        class='tool-icon'
                        role='img'
                        aria-label={`${tool.name} tool icon`}
                      >
                        <img
                          src={tool.iconUrl}
                          alt={`${tool.name} tool icon`}
                          class='tool-icon-image'
                          loading='lazy'
                          decoding='async'
                        />
                      </div>
                      <h3 class='tool-name' id={`tool-name-${tool.id}`}>
                        {tool.name}
                      </h3>
                    </div>
                  </header>

                  <div class='tool-card-body'>
                    <p
                      class='tool-description-card'
                      id={`tool-desc-${tool.id}`}
                    >
                      {getFirstSentence(tool.description)}
                    </p>
                  </div>

                  <footer class='tool-card-footer'>
                    <span class='tool-cta-text'>Lihat Panduan</span>
                    <svg
                      class='tool-arrow'
                      width='16'
                      height='16'
                      viewBox='0 0 24 24'
                      fill='none'
                      stroke='currentColor'
                      stroke-width='2.5'
                      aria-label='Arrow indicating link to tool guide'
                    >
                      <path d='M5 12h14M12 5l7 7-7 7' />
                    </svg>
                  </footer>
                </div>
              </a>
            </article>
          </div>
        ))
      }
      <slot />
    </div>
  </div>
</section>
