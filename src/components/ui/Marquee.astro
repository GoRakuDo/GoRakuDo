---
interface Props {
  class?: string;
  reverse?: boolean;
  pauseOnHover?: boolean;
  vertical?: boolean;
  [key: string]: any;
}

const {
  class: className,
  reverse,
  pauseOnHover = false,
  vertical = false,
  ...props
} = Astro.props;
---

<div
  class:list={[
    'group flex overflow-hidden py-8 [--gap:1rem] gap-(--gap)',
    vertical ? 'flex-col' : 'flex-row',
    vertical ? 'mask-gradient-vertical' : 'mask-gradient-horizontal',
    className,
  ]}
  {...props}
>
  {
    Array(2)
      .fill(0)
      .map(_ => (
        <div
          class:list={[
            'flex shrink-0 gap-(--gap)',
            vertical
              ? 'flex-col items-center animate-marquee-vertical'
              : 'flex-row animate-marquee',
            {
              'pause-on-hover': pauseOnHover,
              'direction-reverse': reverse,
            },
          ]}
        >
          <slot />
        </div>
      ))
  }
</div>

<style>
  @keyframes marquee {
    from {
      transform: translateX(0);
    }

    to {
      transform: translateX(calc(-100% - var(--gap)));
    }
  }

  @keyframes marqueeVertical {
    from {
      transform: translateY(0);
    }

    to {
      transform: translateY(calc(-100% - var(--gap)));
    }
  }

  /* Core animations */
  .animate-marquee {
    animation: marquee var(--duration) linear infinite;
  }

  .animate-marquee-vertical {
    animation: marqueeVertical var(--duration) linear infinite;
  }

  /* Direction control */
  .direction-reverse {
    animation-direction: reverse;
  }

  /* Pause on hover */
  .group:hover .pause-on-hover {
    animation-play-state: paused;
  }

  /* Gradient Mask - Horizontal */
  .mask-gradient-horizontal {
    mask-image: linear-gradient(
      to right,
      transparent,
      black 5%,
      black 95%,
      transparent
    );
  }

  /* Gradient Mask - Vertical */
  .mask-gradient-vertical {
    mask-image: linear-gradient(
      to bottom,
      transparent,
      black 5%,
      black 95%,
      transparent
    );
  }

  /* Force animation on mobile to override any global performance disabling */
  @media (max-width: 768px) {
    /* stylelint-disable declaration-no-important */
    .animate-marquee-vertical {
      will-change: transform;
      transform: translate3d(0, 0, 0);
      animation: marqueeVertical var(--duration) linear infinite !important;
    }

    .animate-marquee {
      will-change: transform;
      transform: translate3d(0, 0, 0);
      animation: marquee var(--duration) linear infinite !important;
    }
    /* stylelint-enable declaration-no-important */
  }

  /* Accessibility: Respect user's motion preferences */
  /* stylelint-disable declaration-no-important */
  @media (prefers-reduced-motion: reduce) {
    .animate-marquee,
    .animate-marquee-vertical {
      animation: none !important;
    }
  }
  /* stylelint-enable declaration-no-important */
</style>
