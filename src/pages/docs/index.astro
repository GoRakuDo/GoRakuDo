---
// シンプルなドキュメントページ - 検索システムなし
import { getCollection, type CollectionEntry } from 'astro:content';
import UnifiedSEO from '../../components/UnifiedSEO.astro';
import Breadcrumb from '../../components/public-components/Breadcrumb.astro';
import Navbar from '../../components/public-components/Navbar.astro';
import PostsHeader from '../../components/docs/PostsHeader.astro';
import PostsGrid from '../../components/docs/PostsGrid.astro';

// Style imports
import '../../styles/global.css';
import '../../styles/docs/docs.css';

// Content processing
let posts: CollectionEntry<'docs'>[] = [];

try {
  // Build-time content filtering and validation
  posts = await getCollection('docs', ({ data }) => {
    return (
      data.status === 'published' &&
      data.publishedDate &&
      new Date(data.publishedDate) <= new Date()
    );
  });

  // Sort posts by publication date (newest first)
  posts.sort(
    (a, b) =>
      new Date(b.data.publishedDate).getTime() -
      new Date(a.data.publishedDate).getTime()
  );
} catch (err: any) {
  console.error('Content processing error:', err.message);
  posts = [];
}

// Transform posts for PostsGrid component
const transformedPosts = posts.map(post => ({
  slug: post.slug,
  title: post.data.title,
  description: post.data.description || '',
  url: `/docs/${post.slug}`,
  publishedDate: post.data.publishedDate,
  emoji: post.data.emoji,
  tags: post.data.tags || [],
  category: post.data.category || 'general',
  isRecommended: false,
  isBeginner: post.data.category === 'getting-started',
  isTool: post.data.category === 'tools',
}));

// SEO data
const seoData = {
  title: 'Dokumentasi & Panduan',
  description:
    'Panduan lengkap untuk memulai perjalanan immersion bahasa Jepang Anda. Dari langkah pertama hingga tingkat lanjut.',
  keywords: [
    'dokumentasi',
    'panduan',
    'tutorial',
    'jepang',
    'belajar',
    'immersion',
  ],
  author: 'Tim GoRakuDo',
};

// Breadcrumb configuration
const breadcrumbConfig = {
  currentPath: '/docs',
  showHome: true,
  variant: 'compact' as const,
  showIcons: true,
  ariaLabel: 'Navigasi breadcrumb untuk halaman dokumentasi',
};
---

<html lang='id'>
  <head>
    <UnifiedSEO
      title={seoData.title}
      description={seoData.description}
      keywords={seoData.keywords}
      canonical='https://gorakudo.org/docs'
      lang='id'
      pageType='article'
      image='https://gorakudo.org/img/FullDC Logo.webp'
      author={seoData.author}
      publishedDate={new Date().toISOString()}
      modifiedDate={new Date().toISOString()}
    />

    <!-- Font loading handled by UnifiedSEO.astro -->
  </head>
  <body>
    <!-- Navigation -->
    <Navbar />

    <!-- Main Content -->
    <main class='main-content'>
      <div class='posts-page'>
        <div class='posts-container'>
          <!-- Breadcrumb Navigation -->
          <Breadcrumb
            currentPath={breadcrumbConfig.currentPath}
            showHome={breadcrumbConfig.showHome}
            variant={breadcrumbConfig.variant}
            showIcons={breadcrumbConfig.showIcons}
            ariaLabel={breadcrumbConfig.ariaLabel}
          />

          <!-- Posts Header -->
          <PostsHeader
            title={seoData.title}
            description={seoData.description}
          />

          <!-- Posts Grid -->
          <PostsGrid posts={transformedPosts} />
        </div>
      </div>
    </main>
  </body>
</html>
