---
// ========== DOCS INDEX PAGE (Minimalist) ==========
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import Breadcrumb from '../../components/common/Breadcrumb.astro';
import PostsHeader from '../../components/docs/PostsHeader.astro';
import PostsGrid from '../../components/docs/PostsGrid.astro';
import Pagination from '../../components/common/Pagination.astro';
import SearchPopover from '../../components/common/SearchPopover.astro';

// ========== GET PAGE DATA ==========
import { getDocsPageData } from '../../utils/docs-config';

// スタイルインポート
import '../../styles/pages/docs/docs-index.css';

// ========== QUERY PARAMETER REDIRECT ==========
const queryPage = Astro.url.searchParams.get('page');
if (queryPage && parseInt(queryPage) > 1) {
  return Astro.redirect(`/docs/page-${queryPage}`, 301);
}

// ========== GET PAGE DATA ==========
const { transformedPosts, totalPages, totalPosts, seoConfig, structuredData } =
  await getDocsPageData(1);
---

<!-- ========== UNIFIED TEMPLATE ========== -->
<ArticleLayout
  title={seoConfig.title}
  description={seoConfig.description}
  tags={seoConfig.keywords}
  lang='id'
  author={seoConfig.author}
  publishedDate={new Date().toISOString()}
>
  <!-- 構造化データ（JSON-LD） -->
  <script
    is:inline
    type='application/ld+json'
    set:html={JSON.stringify(structuredData)}
    slot='head'
  />

  <!-- ページヘッダー -->
  <PostsHeader
    slot='articles-header'
    title={seoConfig.title}
    description={seoConfig.description}
  />

  <!-- ブレッドクラム -->
  <Breadcrumb
    slot='breadcrumb'
    currentPath='/docs'
    showHome={true}
    variant='compact'
    showIcons={true}
    ariaLabel='Navigasi breadcrumb untuk halaman dokumentasi'
  />

  <!-- 検索セクション -->
  <SearchPopover
    slot='search'
    buttonStyle='rounded'
    placeholder='Search documentation...'
    searchAction='/search'
    className='docs-search-popover'
    searchCollections='docs'
  />

  <!-- メインコンテンツ -->
  {
    totalPosts > 0 ? (
      <PostsGrid posts={transformedPosts} />
    ) : (
      <div class='empty-state'>
        <h2>記事が見つかりません</h2>
        <p>
          現在、公開されている記事がありません。しばらくしてから再度お試しください。
        </p>
      </div>
    )
  }

  <!-- ページネーション -->
  {
    totalPages > 1 && totalPosts > 0 && (
      <Pagination
        slot='pagination'
        currentPage={1}
        totalPages={totalPages}
        baseUrl='/docs'
        showPageInfo={true}
      />
    )
  }
</ArticleLayout>
