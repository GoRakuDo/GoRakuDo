---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { firstRow, secondRow } from '../../data/reviews';
import '../../styles/pages/panduan-immersion/animations.css';
import panduanImmersionSeoData from '../../data/seo/pages/panduan-immersion.json';
import { generateBreadcrumbSchema } from '../../utils/breadcrumb-schema';

// Section Components
import HeroEmpathyBridge from '../../components/panduan-immersion/HeroEmpathyBridge.astro';
import StopLearningSection from '../../components/panduan-immersion/StopLearningSection.astro';
import LADSection from '../../components/panduan-immersion/LADSection.astro';
import HistorySection from '../../components/panduan-immersion/HistorySection.astro';
import KrashenSecretSection from '../../components/panduan-immersion/KrashenSecretSection.astro';
import BattleCardsSection from '../../components/panduan-immersion/BattleCardsSection.astro';
import FormulaSection from '../../components/panduan-immersion/FormulaSection.astro';
import KaiwaTrapSection from '../../components/panduan-immersion/KaiwaTrapSection.astro';
import BonsaiRoadmapSection from '../../components/panduan-immersion/BonsaiRoadmapSection.astro';
import NotebookStoriesSection from '../../components/panduan-immersion/NotebookStoriesSection.astro';
import FinalCTASection from '../../components/panduan-immersion/FinalCTASection.astro';
import FAQSection from '../../components/common/FAQSection.astro';

// Cloudinary Image IDs
const empathyBridgeImage = 'Empathy_Bridge_Image_ikv9d4ikv9d4ikv9_ck8fch';
const bloomImage = 'The_Bloom_Image_af0bngaf0bngaf0b_ygey7z';
const seedImage = 'The_Seed_Image_af0bngaf0bngaf0b_vd4ac1';
const sproutImage = 'The_Sprout_Image_af0bngaf0bngaf0b_bdwzmo';
const saplingImage = 'Adolescent_Sapling_Image_af0bngaf0bngaf0b_hvtrlj';
const preBloomImage = 'The_Pre-Bloom_Image_af0bngaf0bngaf0b_qnyni5';

// ========== SEO DATA ==========
const seoData = panduanImmersionSeoData.seoData;
const currentYear = new Date().getFullYear();
const pageTitle = `Panduan Immersion Belajar Bahasa Jepang ${currentYear} dengan OTODIDAK`;

const breadcrumbSchema = generateBreadcrumbSchema({
  items: panduanImmersionSeoData.breadcrumbData.items.map((item, index) => ({
    title: item.name,
    url: item.url,
    isActive: index === panduanImmersionSeoData.breadcrumbData.items.length - 1,
  })),
  siteUrl: String(Astro.site || 'https://gorakudo.org'),
});

const faqSchema = {
  '@context': 'https://schema.org' as const,
  '@type': 'FAQPage' as const,
  mainEntity: panduanImmersionSeoData.faqSchema.mainEntity.map(faq => ({
    '@type': 'Question' as const,
    name: faq.name,
    acceptedAnswer: {
      '@type': 'Answer' as const,
      text: faq.acceptedAnswer.text,
    },
  })),
} as const;

// Transform FAQ schema data to component format
const faqQuestions = panduanImmersionSeoData.faqSchema.mainEntity.map(faq => ({
  question: faq.name,
  answer: faq.acceptedAnswer.text,
}));
---

<BaseLayout
  title={pageTitle}
  description={seoData.description}
  lang={seoData.lang}
  pageType={seoData.pageType as 'article' | 'website'}
  author={seoData.author}
  publishedDate={seoData.publishedDate}
  breadcrumbSchema={breadcrumbSchema}
  faqSchema={faqSchema}
>
  <!-- Main Container -->
  <main class='page-container min-h-[calc(100vh-var(--navbar-height))]'>
    <div class='container mx-auto w-full px-4 md:px-0'>
      <HeroEmpathyBridge empathyBridgeImage={empathyBridgeImage} />

      <StopLearningSection />

      <LADSection />

      <HistorySection />

      <KrashenSecretSection />

      <BattleCardsSection />

      <FormulaSection />
    </div>

    <KaiwaTrapSection />

    <style>
      /* Local Scoped Styles */
      .page-container {
        /* Safe minimum height */
        min-height: 80vh;
      }
    </style>

    <BonsaiRoadmapSection
      bloomImage={bloomImage}
      seedImage={seedImage}
      sproutImage={sproutImage}
      saplingImage={saplingImage}
      preBloomImage={preBloomImage}
    />
  </main>

  <NotebookStoriesSection firstRow={firstRow} secondRow={secondRow} />

  <!-- FAQ Section (visible content matching JSON-LD schema) -->
  <div class='container mx-auto w-full px-4 md:px-0'>
    <FAQSection questions={faqQuestions} />
  </div>

  <FinalCTASection />
</BaseLayout>
