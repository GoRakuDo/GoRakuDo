<!-- Powered by BMAD™ Core -->

# Story 1.3B: 中優先度ファイル統合実装

## User Story

**As a** 開発者（TypeScript経験者）
**I want** 中優先度の2つの古い型定義ファイルを新しい統合システムに移行する
**So that** メタデータ関連と最適化関連の型定義システムの統合を完了し、システム全体の一貫性を向上させる

## Story Context

### Existing System Integration

- **Integrates with**: 新しい統合型定義システム（new-seo-system/）
- **Technology**: TypeScript 5.0以上、VS Code開発環境
- **Follows pattern**: 段階的移行の実装パターン
- **Touch points**: メタデータ関連と最適化関連ファイルの統合

## Acceptance Criteria

### Functional Requirements

1. metadata-input.tsの統合完了（メタデータ入力、バリデーションルール）
2. advanced-optimization.tsの統合完了（品質監視、アルゴリズム高度化）
3. 各統合ステップでのTypeScriptコンパイル成功
4. 既存のインポート文の更新完了
5. 重複コードの完全削除

### Integration Requirements

6. Existing 既存機能の動作が維持されている
7. New functionality follows existing 新システムの型定義パターンに従う
8. Integration with 新システムの型定義が正しく機能する

### Quality Requirements

9. Change is covered by appropriate tests（各統合ステップでのテスト実施）
10. Documentation is updated if needed（統合結果のドキュメント化）
11. No regression in existing functionality verified（既存機能への回帰テスト）

## Technical Notes

### Integration Approach
- 優先度順の段階的統合（metadata-input.ts → advanced-optimization.ts）
- 各ステップでの完全な型チェック
- 段階的コミットによるリスク低減

### Existing Pattern Reference
- 既存の段階的移行実装パターン
- DRY・KISS原則の実装パターン
- 型安全性の確保パターン

### Key Constraints
- 統合順序: metadata-input.ts → advanced-optimization.ts
- 品質基準: TypeScript strictモードエラー0件
- 時間枠: 3日間

## Definition of Done

- [ ] metadata-input.tsの統合完了
- [ ] advanced-optimization.tsの統合完了
- [ ] TypeScript strictモード通過
- [ ] インポート文更新完了
- [ ] 重複コード完全削除
- [ ] 既存機能維持確認
- [ ] npm run build: 0 hints, 0 warnings, 0 errors
- [ ] astro check: 0 hints, 0 warnings, 0 errors

## Implementation Phases

### Phase 2.2: 中優先度ファイル統合（3日間）

#### Day 3-4: メタデータ関連統合

##### **3. metadata-input.ts** → `new-seo-system/validation-types.ts`

**統合前の準備作業：**
```bash
# 独自型定義の特定
grep -A 10 -B 10 "export interface\|export type" src/types/metadata-input.ts
```

**統合作業手順：**
```typescript
// 1. 独自型定義の特定と移動
// 以下の独自型定義を新システムの適切なファイルに移動
export type PartialMetadataInput = Partial<MetadataInput>;
export interface MetadataFieldUpdate { /* 独自実装 */ }
export type MetadataInputEvent = /* 独自実装 */;

// 2. 再エクスポート部分の削除
// 以下の行を削除
export type {
  MetadataInput,
  MetadataValidationResult,
  MetadataReadResult,
  KeywordData,
  MetadataInputFormState,
  MetadataInputConfig,
  ValidationRule
} from './new-seo-system/validation-types.js';

export type { ValidationError, ValidationWarning } from './new-seo-system/base-types.js';

// 3. インポート文の更新
// 新システムから直接インポート
import type {
  MetadataInput,
  MetadataValidationResult,
  MetadataReadResult,
  KeywordData,
  MetadataInputFormState,
  MetadataInputConfig,
  ValidationRule
} from './new-seo-system/validation-types.js';

import type { ValidationError, ValidationWarning } from './new-seo-system/base-types.js';
```

**統合後の確認作業：**
```bash
# 4. TypeScriptコンパイル確認
npm run build

# 5. 既存機能の動作確認
npm run test

# 6. コミット
git add src/types/metadata-input.ts
git commit -m "feat: integrate metadata-input.ts to new system

- Remove re-export statements
- Move custom type definitions
- Use new system types directly
- Maintain existing functionality"
```

#### Day 5: 最適化関連統合

##### **4. advanced-optimization.ts** → `new-seo-system/validation-types.ts`

**統合前の準備作業：**
```bash
# 独自型定義の特定
grep -A 10 -B 10 "export interface\|export type" src/types/advanced-optimization.ts
```

**統合作業手順：**
```typescript
// 1. 独自型定義の特定と移動
// 以下の独自型定義を新システムの適切なファイルに移動
export interface AdvancedQualityMonitoringConfig { /* 独自実装 */ }
export interface AdvancedQualityMonitoringResult { /* 独自実装 */ }
export interface AlgorithmEnhancementConfig { /* 独自実装 */ }
export interface AlgorithmEnhancementResult { /* 独自実装 */ }
export interface PhaseCompletionStatus { /* 独自実装 */ }
export interface PhaseQualityGate { /* 独自実装 */ }

// 2. 再エクスポート部分の削除
// 以下の行を削除
export type {
  AdvancedOptimizationConfig,
  AdvancedOptimizationResult,
  StructuredDataConfig,
  StructuredDataResult,
  QualityGateConfig,
  QualityGateResult,
  TestCleanupConfig,
  TestCleanupResult,
  RedundantFileInfo
} from './new-seo-system/validation-types.js';

// 3. インポート文の更新
// 新システムから直接インポート
import type {
  AdvancedOptimizationConfig,
  AdvancedOptimizationResult,
  StructuredDataConfig,
  StructuredDataResult,
  QualityGateConfig,
  QualityGateResult,
  TestCleanupConfig,
  TestCleanupResult,
  RedundantFileInfo
} from './new-seo-system/validation-types.js';
```

**統合後の確認作業：**
```bash
# 4. TypeScriptコンパイル確認
npm run build

# 5. 既存機能の動作確認
npm run test

# 6. コミット
git add src/types/advanced-optimization.ts
git commit -m "feat: integrate advanced-optimization.ts to new system

- Remove re-export statements
- Move custom type definitions
- Use new system types directly
- Maintain existing functionality"
```

## Quality Gates

### Integration Quality Gates
1. **各ファイル統合後**: TypeScriptコンパイル成功
2. **Phase完了時**: 既存機能の動作確認
3. **全統合完了時**: strictモードでの完全検証

### Performance Gates
1. **ビルド時間**: 既存レベル維持
2. **バンドルサイズ**: 最適化による削減確認
3. **実行時パフォーマンス**: 既存レベル以上

## Backup Strategy

### Pre-Integration Backup
```bash
# 統合開始前のバックアップ
mkdir -p backup/integration/$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="backup/integration/$(date +%Y%m%d_%H%M%S)"
cp -r src/types/ $BACKUP_DIR/
echo "✅ バックアップ完了: $BACKUP_DIR"
```

### Incremental Commits
```bash
# 各統合ステップでのコミット
git add src/types/
git commit -m "feat: integrate {filename} to new system

- Remove re-export statements
- Move custom type definitions
- Use new system types directly
- Maintain existing functionality"
```

## Rollback Procedures

### Single File Rollback
```bash
# 特定のファイル統合のロールバック
git checkout HEAD~1 -- src/types/{filename}
npm run build
npm run test
```

### Phase Rollback
```bash
# Phase 2.2のロールバック
git checkout HEAD~2 -- src/types/metadata-input.ts src/types/advanced-optimization.ts
npm run build
npm run test
```

## Success Metrics

- **統合完了率**: 2/2ファイル（100%）
- **コンパイル成功率**: 100%
- **既存機能維持率**: 100%
- **コード重複削減**: メタデータ・最適化部分の重複を完全削除
- **保守工数削減**: メタデータ・最適化部分の保守工数を削減

## Integration Checklist

### Phase 2.2: 中優先度ファイル統合
- [ ] metadata-input.tsの統合完了
- [ ] advanced-optimization.tsの統合完了
- [ ] TypeScript strictモード通過
- [ ] 既存機能の動作確認
- [ ] コミット完了

### 最終確認
- [ ] 中優先度ファイルの統合完了
- [ ] TypeScript strictモード通過
- [ ] 既存機能の完全動作確認
- [ ] 重複コードの完全削除確認
- [ ] 最終コミット完了

## Dependencies

- **前提条件**: Story 1.1, 1.2, 1.3Aの完了
- **並行作業**: 継続的なテスト実行
- **後続作業**: Story 1.3C（低優先度ファイル統合）

## Implementation Notes

### 重要な注意事項
1. **段階的実装**: 一度にすべて変更せず、1つのファイルずつ統合
2. **品質確認**: 各統合後に必ずTypeScriptコンパイルとテストを実行
3. **バックアップ**: Phase開始前にバックアップを作成
4. **コミット**: 各統合完了後に確実にコミットを作成

### トラブルシューティング
- **型エラーが発生した場合**: 型定義の対応関係を再確認
- **コンパイルエラーが発生した場合**: インポート文の更新漏れを確認
- **既存機能が動作しない場合**: 型定義の互換性を確認

### 独自型定義の移動について
- 独自型定義は新システムの適切なファイルに移動
- 移動後は既存のインポート文を更新
- 型定義の整合性を確認

---

**作成日**: 2024-12-31
**見積り時間**: 3日間
**優先度**: 中（メタデータ・最適化統合段階）
**依存関係**: Story 1.1, 1.2, 1.3A完了必須
**レビュアー**: アーキテクト、シニア開発者
**成果物**: 統合されたメタデータ・最適化型定義システム、統合レポート、コミット履歴
