<!-- Powered by BMAD™ Core -->

# Story 4: MD投稿の手動メタデータ入力機能拡張

## Status

**⏳ Ready for Development** - 手動メタデータ入力システムの実装準備完了  
**🚀 DRY + KISS原則適用済み** - リスク軽減と既存システム活用による最適化完了

## Story

**As a** コンテンツ作成者,
**I want** MDファイルに手動でメタデータとキーワードを入力できる機能,
**So that** Gemini APIに依存せずに、自分でコントロールできる高品質なメタデータを作成できる.

## 高校生向け説明

### 🎯 何をやるの？
今までGemini APIが自動で作っていた「メタデータ」という、記事の説明やキーワードを、今度は人間が手動で入力できるようにするんだ。

**メタデータって何？**
- 記事のタイトル、説明、キーワードなどの情報
- 検索エンジンが記事を理解するのに使う
- 読者が記事の内容を把握するのに役立つ

### 🔧 どうやって実装するの？
1. **直接読み込み機能**: 既存の.mdファイルから直接メタデータとキーワードを読み込む
2. **フロントマター活用**: 記事の上部にあるYAML形式の情報を活用する
3. **既存システム統合**: 今あるコンテンツ管理システムと連携する

### 🚀 DRY + KISS原則による改善点
- **DRY原則**: 既存のシステムやコンポーネントを最大限再利用
- **KISS原則**: 複雑な機能よりもシンプルで分かりやすい機能を優先

## Acceptance Criteria

**手動入力機能要件:**

1. MDファイル編集時にメタデータ入力フィールドを表示
2. タイトル、説明、キーワードの個別入力フィールドを提供
3. リアルタイムでの入力内容プレビュー機能
4. 入力内容のバリデーション（文字数制限、必須項目チェック）

**キーワード機能強化要件:**

5. キーワードの追加・削除・編集が可能
6. 関連キーワードの提案機能（既存記事からの自動提案）
7. キーワードの重複チェック機能
8. キーワードの優先度設定機能

**ユーザビリティ要件:**

9. 直感的で使いやすいインターフェース
10. 入力内容の自動保存機能
11. 入力履歴の表示機能
12. モバイルデバイスでの使いやすさ

## General Principles

### 1. DRY (Don't Repeat Yourself - 繰り返しを避ける)
- **MANDATORY**: コードの重複を避けます
- 共通のメタデータ読み込みパターンは再利用可能なユーティリティ関数に抽象化します
- 同様のバリデーションロジックが3回以上出現する場合は、必ず共通化を検討します
- 設定値や定数は一箇所で管理し、複数箇所でハードコーディングしないでください
- 共通のユーティリティ関数は`src/utils/`に集約し、複数のコンポーネントで再利用します

### 2. KISS (Keep It Simple, Stupid - シンプルにしておけ)
- **MANDATORY**: 複雑な解決策よりもシンプルな解決策を優先します
- 過度に抽象化したり、パターンを適用しすぎないでください
- 読みやすく理解しやすいコードを書いてください
- 複雑なロジックが必要な場合は、必ずコメントで理由を説明してください
- 既存.mdファイルの利点を活かし、必要最小限のツールで実装します

### 3. User Experience First
- ユーザーが迷わない直感的なインターフェース
- 入力ミスを防ぐためのガイダンス表示
- モバイルファーストのレスポンシブデザイン

### 4. Progressive Enhancement
- 基本的な入力機能はJavaScriptなしで動作
- 高度な機能は段階的に追加
- アクセシビリティ基準の維持

## 🚀 Enhanced Tasks / Subtasks (DRY + KISS原則適用)

- [ ] 手動メタデータ入力フォームの作成（AC: #1-4）
  - [ ] MDファイル編集画面への入力フィールド統合（既存UIパターン活用）
  - [ ] タイトル、説明、キーワードの個別フィールド実装（既存フォームコンポーネント活用）
  - [ ] リアルタイムプレビュー機能の実装（既存プレビューシステム活用）
  - [ ] 入力内容のバリデーション機能実装（既存バリデーションパターン活用）

- [ ] キーワード機能の強化（AC: #5-8）
  - [ ] キーワードの追加・削除・編集機能実装（既存CRUDパターン活用）
  - [ ] 関連キーワード提案機能の実装（既存Fuse.js検索インフラ活用）
  - [ ] 重複チェック機能の実装（既存重複チェックロジック活用）
  - [ ] 優先度設定機能の実装（既存優先度管理システム活用）

- [ ] ユーザビリティの向上（AC: #9-12）
  - [ ] 直感的なインターフェースの設計・実装（既存UIパターン活用）
  - [ ] 自動保存機能の実装（既存自動保存システム活用）
  - [ ] 入力履歴表示機能の実装（既存履歴管理システム活用）
  - [ ] 読み込み機能の最適化（既存パフォーマンス監視ツール活用）

## 🎯 Enhanced Dev Notes (DRY + KISS原則強化)

### 🚀 実装者向けクイックスタート

#### 1. 即座に必要な情報（Phase 1開始用）
- **Story 3B完了確認**: メタデータの移行とバックアップが完了していることを確認
- **既存UIパターン**: 現在のMD編集画面の構造とスタイル（`src/components/`から活用）
- **品質要件**: ユーザビリティとアクセシビリティの確保（既存ガイドライン活用）

#### 2. 実装順序（依存関係考慮済み）
- **Phase 1**: 基本的な手動入力フォームの作成（Story 3B完了確認後）
- **Phase 2**: キーワード機能の強化（基本フォーム完了後）
- **Phase 3**: ユーザビリティの向上（全機能完了後）

#### 3. Story 3Bとの連携ポイント
- **移行完了確認**: Story 3Bでメタデータ移行が完了していることを確認
- **既存メタデータ**: 移行された既存メタデータとの互換性確認
- **段階的実装**: 基本機能から高度な機能への段階的実装

#### 4. 具体的な実装手順（DRY + KISS原則適用）

**重要**: 各フェーズ完了後には必ずビルドとTypeScriptチェックを実行し、システムの安定性を確認してください。これにより、段階的な実装での問題を早期に発見できます。

**既存システムの活用（DRY原則）:**
- **.mdファイル**: 既存のフロントマター構造を活用（@anki-guide.mdのような形式）
- **コンテンツ管理**: 既存の`src/content/`システムを活用
- **型定義**: 既存のTypeScript型定義とバリデーションロジックを再利用
- **検索**: 既存のFuse.js 7.1.0検索インフラを活用
- **パフォーマンス**: 既存のパフォーマンス監視ツールを統合
- **セキュリティ**: 既存のセキュリティユーティリティを活用

**Phase 1: 基本的なメタデータ読み込み機能の作成（DRY + KISS原則）**
```bash
# 1. Story 3B完了の確認
cat bmad-docs/stories/epic-metadata-removal-story-3b.md

# 2. 既存.mdファイル構造の確認（既存システム活用）
find src/content/ -name "*.md" -exec head -10 {} \;
find src/ -name "*.ts" -exec grep -l "frontmatter\|metadata" {} \;

# 3. 最小限のメタデータ読み込みツールの作成（KISS原則）
mkdir -p src/utils/metadata-input
touch src/types/metadata-input.ts
touch src/utils/metadata-input/metadata-reader.js

# 4. 既存.mdファイルからのメタデータ読み込み確認（既存データ活用）
find src/content/ -name "*.md" -exec grep -A 20 "---" {} \;
find src/content/ -name "*.md" -exec grep -l "tags:" {} \;

# 5. ビルドとTypeScriptチェック（Phase 1完了後）
npm run build
npm run astro check
```

**Phase 2: キーワード機能の強化（DRY + KISS原則）**
```bash
# 1. 既存.mdファイルからのキーワード読み込み機能（既存システム活用）
# 既存のmetadata-reader.jsを拡張してキーワード抽出機能を追加

# 2. 既存検索インフラの活用（Fuse.js + 既存検索データ）
# 既存の検索システムを活用してキーワード提案

# 3. ビルドとTypeScriptチェック（Phase 2完了後）
npm run build
npm run astro check
```

**Phase 3: ユーザビリティの向上（DRY + KISS原則）**
```bash
# 1. 既存.mdファイルからの直接読み込み最適化（既存システム活用）
# metadata-reader.jsのパフォーマンス向上

# 2. 既存のコンテンツ管理システムとの統合強化（既存システム活用）
# 既存の.mdファイル構造を活用

# 3. ビルドとTypeScriptチェック（Phase 3完了後）
npm run build
npm run astro check
```

### 🚀 技術的詳細（DRY + KISS原則強化）

#### データモデルとスキーマ（既存システム活用）
- **メタデータ構造**: 既存のフロントマター形式を維持（`src/content/config.ts`準拠）
- **キーワード管理**: 配列形式でのキーワード保存（Strict TypeScript型定義）
- **優先度設定**: 数値（1-5）での優先度管理
- **フロントマター形式**: YAML形式でのメタデータ保存

#### 直接読み込みアプローチ（.mdファイル準拠、KISS原則）
- **既存.mdファイル**: フロントマターから直接メタデータとキーワードを読み込み
- **フロントマター**: YAML形式でのメタデータ管理
- **読み込みツール**: 最小限のメタデータ読み込み機能

#### ファイル配置（既存プロジェクト構造準拠、DRY原則）
- **既存.mdファイル**: `src/content/`（既存のコンテンツ管理システム）
- **ユーティリティ**: `src/utils/metadata-input/`（ES Modules .jsファイル）
- **型定義**: `src/types/metadata-input.ts`（Strict TypeScript型定義）
- **読み込み機能**: メタデータとキーワードの直接読み込み

#### テスト要件（既存プロジェクト準拠、DRY原則）
- **テストファイル配置**: 既存の`tests/unit/`、`tests/integration/`構造を活用
- **テストフレームワーク**: Jest（既存プロジェクトの標準）
- **カバレッジ**: 既存のJest設定で90%以上のテストカバレッジを目標
- **ビルド検証**: 各フェーズ完了後のビルドプロセスの正常動作確認
- **.md読み込みテスト**: フロントマター読み込みのテスト
- **TypeScript テスト**: 型安全性のテストとTypeScriptコンパイルチェック

### 🚀 プロジェクト構造の整合性（DRY + KISS原則強化）

#### 既存パターンとの整合性（tech-stack.md準拠）
- **.mdファイル**: 既存のコンテンツ管理システムを活用（フロントマター形式）
- **スタイル**: 既存のTailwind CSS 4.1.12設定を活用（JIT compilation）
- **テスト**: 既存のJestテスト構造に準拠
- **検索**: 既存のFuse.js 7.1.0検索インフラを活用
- **パフォーマンス**: 既存のパフォーマンス監視ツールを統合

#### 構造的注意点（既存プロジェクト準拠、DRY原則）
- 既存の.mdファイル命名規則を維持（既存のコンテンツ管理システム準拠）
- 既存のフロントマター構造を活用（@anki-guide.mdのような形式）
- 既存のTailwind CSSクラスとカスタムカラーパレットを活用
- 既存のTypeScript設定（ES2020 target, strict mode）に準拠
- 既存の.mdファイル読み込みシステムに従う
- 既存のコンテンツ管理システム（`src/content/`）との互換性確保

### 🚀 セキュリティ考慮事項（既存プロジェクト準拠、DRY原則）

#### 入力値の検証（既存セキュリティシステム活用）
- XSS攻撃を防ぐための入力値サニタイゼーション（DOMPurify 3.2.6活用）
- 適切な文字数制限とバリデーション（Strict TypeScript型安全性）
- 機密情報の入力防止（既存セキュリティユーティリティ活用）

#### データ保護（既存セキュリティインフラ活用）
- 入力内容の適切な暗号化（既存セキュリティインフラ活用）
- セッション管理の強化（ES Modules + localStorage）
- アクセス制御の実装（既存セキュリティパターン準拠）
- 環境変数管理（dotenv 17.2.1準拠）

### 🚀 エラーハンドリングと復旧（既存プロジェクト準拠、DRY原則）

#### 入力エラー時の対応（既存エラーハンドリング活用）
- 分かりやすいエラーメッセージの表示（読み込みエラー時の表示）
- 読み込み内容の自動復旧機能（既存データの活用）
- バリデーションエラーの詳細表示（Strict TypeScript型安全性）
- 既存のエラーハンドリングパターンを活用

#### システムエラー時の対応（既存システム活用）
- 自動保存された内容の復旧（既存バックアップシステム活用）
- エラー状態からの復旧手順（既存エラー復旧パターン準拠）
- ユーザーへの適切なガイダンス（既存UIパターン活用）
- パフォーマンス監視ツールとの統合（既存監視システム活用）

## 🚀 Enhanced Testing (DRY + KISS原則適用)

### テストファイルの配置（既存プロジェクト準拠、DRY原則）
- **メタデータ読み込みテスト**: `tests/unit/metadata-input/`（.md読み込み + Jest）
- **キーワード機能テスト**: `tests/unit/keyword-management/`（Strict TypeScript + Jest）
- **統合テスト**: `tests/integration/metadata-input/`（E2E + Jest）
- **Astro.js テスト**: Astroコンポーネントのテスト
- **型安全性テスト**: TypeScriptコンパイルチェックと型テスト

### テスト基準（既存システム活用）
- **テストフレームワーク**: Jest（既存プロジェクトの標準）
- **カバレッジ**: 既存のJest設定で90%以上のテストカバレッジを目標

### このストーリー固有のテスト要件（既存プロジェクト準拠、DRY原則）
- **.md読み込み**: フロントマターの正常読み込み確認（直接読み込み）
- **キーワード管理**: 追加・削除・編集機能の検証（Strict TypeScript型安全性）
- **バリデーション**: 入力値の適切な検証（既存バリデーションパターン活用）
- **ユーザビリティ**: 直感的な読み込み操作の確認（直接読み込み）
- **パフォーマンス**: 既存パフォーマンス監視ツールとの統合テスト
- **セキュリティ**: 既存セキュリティツール（DOMPurify）との統合テスト

### テスト実行手順（既存プロジェクト準拠、DRY原則）
```bash
# 既存テストインフラの活用（DRY原則）
node tests/run-tests.js

# .md読み込みテスト
npx jest tests/unit/metadata-input/ --testEnvironment=jsdom

# Strict TypeScript ユーティリティテスト
npx jest tests/unit/keyword-management/ --testEnvironment=node

# 統合テスト（E2E）
npx jest tests/integration/metadata-input/

# TypeScript 型チェック
npm run astro check

# ビルドテスト
npm run build

# カバレッジレポートの生成
npx jest --coverage --testEnvironment=jsdom
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 初回作成 | Bob (Scrum Master) |
| 2024-12-19 | 1.1 | Vue.jsからAstro.jsへの変更、Strict TypeScript、ES Modules対応 | Sarah (PO) |
| 2024-12-19 | 1.2 | DRY + KISS原則による強化、リスク軽減、既存システム活用の最適化 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
**dev** - Full Stack Developer (TBD)

### Debug Log References
- **Phase 1**: 基本的な手動入力フォームの作成（未開始）
- **Phase 2**: キーワード機能の強化（未開始）
- **Phase 3**: ユーザビリティの向上（未開始）

### Completion Notes List
⏳ **Phase 1**: 基本的な手動入力フォームの作成（未開始）
- MDファイル編集画面への入力フィールド統合（既存UIパターン活用）
- タイトル、説明、キーワードの個別フィールド実装（既存フォームコンポーネント活用）
- リアルタイムプレビュー機能の実装（既存プレビューシステム活用）
- 入力内容のバリデーション機能実装（既存バリデーションパターン活用）

⏳ **Phase 2**: キーワード機能の強化（未開始）
- キーワードの追加・削除・編集機能実装（既存CRUDパターン活用）
- 関連キーワード提案機能の実装（既存Fuse.js検索インフラ活用）
- 重複チェック機能の実装（既存重複チェックロジック活用）
- 優先度設定機能の実装（既存優先度管理システム活用）

⏳ **Phase 3**: ユーザビリティの向上（未開始）
- 直感的なインターフェースの設計・実装（既存UIパターン活用）
- 自動保存機能の実装（既存自動保存システム活用）
- 入力履歴表示機能の実装（既存履歴管理システム活用）
- 読み込み機能の最適化（既存パフォーマンス監視ツール活用）

### File List
**新規作成予定ファイル（Astro.js + Strict TypeScript + ES Modules準拠、DRY + KISS原則適用）:**

**超シンプルな.md直接読み込みアプローチ（KISS原則）:**
- 既存の.mdファイルから直接メタデータとキーワードを読み込み
- フロントマター形式でのメタデータ管理
- 既存のコンテンツ管理システムを活用
- 追加の.jsファイルは最小限

**最小限のユーティリティ（.ts）:**
- `src/types/metadata-input.ts` - メタデータ入力の型定義（strict mode準拠）

**最小限の読み込みツール（.js）:**
- `src/utils/metadata-input/metadata-reader.js` - .mdファイルからのメタデータ読み込み（ES Modules準拠）

**既存ファイル（変更予定、DRY原則適用）:**
- MD編集画面のコンポーネント（特定後、既存UIパターン活用）
- 既存のスタイル設定（Tailwind CSS 4.1.12）
- 既存のテスト設定（Jest）
- 既存の検索インフラ（Fuse.js 7.1.0）
- 既存のパフォーマンス監視ツール
- 既存のコンテンツ管理システム（`src/content/`）

## 🚀 Enhanced QA Results (DRY + KISS原則適用)

### Review Date: TBD

### Reviewed By: TBD

### Code Quality Assessment

**TBD** - 実装完了後に評価予定

### Refactoring Performed

**なし** - 新規実装のため

### Compliance Check

- Coding Standards: ⏳ 実装完了後に評価予定
- Project Structure: ⏳ 実装完了後に評価予定
- Testing Strategy: ⏳ 実装完了後に評価予定
- All ACs Met: ⏳ 実装完了後に評価予定

### 🚀 Enhanced Improvements Checklist (DRY + KISS原則適用)

- [ ] 既存UIパターンの活用（DRY原則）
- [ ] 既存スタイル設定の活用（DRY原則）
- [ ] 段階的実装によるリスク最小化（KISS原則）
- [ ] 既存ビルドシステムの活用（DRY原則）
- [ ] 包括的なテスト環境の構築（既存テストインフラ活用）
- [ ] ユーザビリティの最適化（既存UIパターン活用）
- [ ] モバイル対応の実装（既存レスポンシブパターン活用）
- [ ] アクセシビリティの確保（既存ガイドライン活用）

### Security Review

**セキュリティ評価予定** ⏳
- 入力値のサニタイゼーション（既存DOMPurify活用）
- XSS攻撃の防止（既存セキュリティパターン活用）
- 適切なバリデーション（既存バリデーションロジック活用）

### Performance Considerations

**パフォーマンス評価予定** ⏳
- 入力フィールドの応答性（既存パフォーマンス監視ツール活用）
- リアルタイムプレビューの最適化（既存最適化パターン活用）
- モバイルデバイスでの動作（既存モバイルパターン活用）

### Files Modified During Review

**なし** - レビュー中にファイルの修正は行っていません。

### Gate Status

**Gate: PENDING** ⏳ → 実装完了後に評価予定

### 🚀 Enhanced Recommended Status

⏳ **Ready for Development** - Story 3B完了後に実装開始予定。DRY + KISS原則の適用により、既存UIパターンの活用で効率的な開発が可能。Astro.jsコンポーネント、Strict TypeScript、ES Modulesの使用により、保守性とパフォーマンスが向上。

**🎯 DRY + KISS原則による主要な改善点:**
1. **既存システムの最大限活用** - 再利用可能コンポーネントの特定と活用
2. **リスクの大幅軽減** - 既存セキュリティパターンとUIコンポーネントの活用
3. **開発効率の向上** - 既存テストインフラとビルドシステムの活用
4. **保守性の向上** - シンプルな実装アプローチと既存パターンの活用
