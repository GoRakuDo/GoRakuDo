<!-- Powered by BMAD™ Core -->

# Story 3.1: メタデータの移行とバックアップ

## Status

**Draft**

## Story

**As a** システムアーキテクト and 開発者,
**I want** 既存メタデータを安全にバックアップし、手動入力システムへの移行を準備する,
**So that** データ損失を防ぎ、段階的な移行が可能になる.

## Acceptance Criteria

**バックアップ要件:**

1. 既存の全メタデータファイルの完全バックアップを作成
2. バックアップの整合性と完全性を検証
3. バックアップファイルの安全な保管場所を確保
4. バックアップからの復元手順を文書化

**移行準備要件:**

5. 現在のメタデータ構造を分析し、手動入力システムとの互換性を確認
6. 移行に必要なデータ変換スクリプトを準備
7. 移行テスト環境の構築
8. 移行時のデータ整合性チェック機能を実装

**品質保証要件:**

9. バックアップ完了後のシステム動作確認
10. 移行準備完了後の包括的な検証

## Tasks / Subtasks

- [ ] 既存メタデータの完全バックアップ（AC: #1-4）
  - [ ] 全メタデータファイルの特定とリスト化
  - [ ] バックアップスクリプトの作成と実行
  - [ ] バックアップの整合性検証
  - [ ] 安全な保管場所への移動とアクセス制御

- [ ] メタデータ構造の分析と移行準備（AC: #5-8）
  - [ ] 現在のメタデータ構造の詳細分析
  - [ ] 手動入力システムとの互換性チェック
  - [ ] データ変換スクリプトの開発
  - [ ] 移行テスト環境の構築

- [ ] 品質保証と検証（AC: #9-10）
  - [ ] バックアップ完了後のシステム動作確認
  - [ ] 移行準備完了後の包括的な検証

## Dev Notes

### 🚀 実装者向けクイックスタート

#### 1. 即座に必要な情報（Phase 1開始用）
- **Story 2B完了確認**: Gemini API統合の完全削除が完了していることを確認
- **バックアップ対象**: 既存の全メタデータファイルと関連設定
- **品質要件**: データの完全性とシステム安定性の確保

#### 2. 実装順序（依存関係考慮済み）
- **Phase 1**: 既存メタデータの完全バックアップ（Story 2B完了確認後）
- **Phase 2**: メタデータ構造の分析と移行準備（バックアップ完了後）
- **Phase 3**: 品質保証と検証（全要件完了後）

#### 3. Story 2Bとの連携ポイント
- **削除完了確認**: Story 2BでGemini API統合が完全に削除されていることを確認
- **システム安定性**: 削除後のシステムが正常動作していることを確認
- **段階的実装**: バックアップ完了後の移行準備

#### 4. 具体的な実装手順

**重要**: 各フェーズ完了後には必ずビルドとTypeScriptチェックを実行し、システムの安定性を確認してください。これにより、段階的な実装での問題を早期に発見できます。

**Phase 1: 既存メタデータの完全バックアップ**
```bash
# 1. Story 2B完了の確認
cat bmad-docs/stories/epic-metadata-removal-story-2b.md

# 2. 既存メタデータファイルの特定
find src/ -name "*.md" -exec grep -l "metadata\|keywords\|description" {} \;

# 3. バックアップディレクトリの作成
mkdir -p backups/metadata-$(date +%Y%m%d)

# 4. バックアップの実行
cp -r src/content/* backups/metadata-$(date +%Y%m%d)/

# 5. ビルドとTypeScriptチェック（Phase 1完了後）
npm run build
npm run type-check
```

**Phase 2: メタデータ構造の分析と移行準備**
```bash
# 1. メタデータ構造の分析
npm run analyze:metadata-structure

# 2. 互換性チェック
npm run check:manual-input-compatibility

# 3. データ変換スクリプトの開発
npm run develop:conversion-scripts

# 4. 移行テスト環境の構築
npm run setup:migration-test-env

# 5. ビルドとTypeScriptチェック（Phase 2完了後）
npm run build
npm run type-check
```

**Phase 3: 品質保証と検証**
```bash
# 1. バックアップ完了後のシステム動作確認
npm run verify:system-stability

# 2. 移行準備完了後の包括的な検証
npm run validate:migration-readiness

# 3. ビルドとTypeScriptチェック（Phase 3完了後）
npm run build
npm run type-check
```

### 技術的詳細

#### データモデルとスキーマ
- **メタデータファイル**: Markdownファイル内のフロントマター形式
- **バックアップ形式**: タイムスタンプ付きディレクトリ構造
- **移行スクリプト**: Node.jsベースの変換ツール

#### API仕様
- **バックアップAPI**: ファイルシステムベースのバックアップ操作
- **検証API**: バックアップ整合性の確認機能
- **移行API**: データ変換と移行の実行機能

#### ファイル配置
- **バックアップ場所**: `backups/metadata-YYYYMMDD/`
- **移行スクリプト**: `src/scripts/migration/`
- **テスト環境**: `src/test/migration/`

#### テスト要件
- **バックアップテスト**: ファイルの完全性と整合性の検証
- **移行テスト**: データ変換の正確性とシステム動作の確認
- **統合テスト**: 全体的な移行プロセスの検証
- **ビルド検証**: 各フェーズ完了後のビルドプロセスの正常動作確認
- **TypeScriptチェック**: 型安全性とコード品質の継続的検証

#### 技術的制約
- **Node.js 18+**: 最新のNode.js機能を活用
- **ファイルシステム**: 安全なファイル操作とエラーハンドリング
- **パフォーマンス**: 大容量データの効率的な処理

### プロジェクト構造の整合性

#### 既存パターンとの整合性
- **バックアップディレクトリ**: `backups/`ディレクトリの作成（新規）
- **移行スクリプト**: `src/scripts/migration/`への配置
- **テスト環境**: `src/test/migration/`への配置

#### 構造的注意点
- バックアップディレクトリは`.gitignore`に追加
- 移行スクリプトは既存のスクリプト構造に準拠
- テスト環境は既存のテストパターンに従う

## Testing

### テストファイルの配置
- **バックアップテスト**: `src/test/backup/`
- **移行テスト**: `src/test/migration/`
- **統合テスト**: `src/test/integration/`

### テスト基準
- **テストフレームワーク**: Jest（既存プロジェクトの標準）
- **テストパターン**: ユニットテスト、統合テスト、E2Eテスト
- **カバレッジ**: 90%以上のテストカバレッジを目標

### このストーリー固有のテスト要件
- **バックアップ整合性**: ファイルの完全性とメタデータの保持確認
- **移行準備**: データ変換スクリプトの正確性検証
- **システム安定性**: バックアップ完了後の動作確認
- **段階的ビルド検証**: 各フェーズ完了後のビルドプロセスの正常動作確認
- **継続的TypeScriptチェック**: 各フェーズでの型安全性とコード品質の維持

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 初回作成 | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
*開発エージェントが実装時に記入*

### Debug Log References
*開発エージェントが実装時に記入*

### Completion Notes List
*開発エージェントが実装時に記入*

### File List
*開発エージェントが実装時に記入*

## QA Results

*QAエージェントがレビュー時に記入*
